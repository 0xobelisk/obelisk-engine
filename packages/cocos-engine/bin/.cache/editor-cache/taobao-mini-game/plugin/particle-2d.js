System.register(["./index-433d8403.js","./sprite-renderer-6181a621.js","./director-c293a59c.js","./node-event-0336ef70.js","./pipeline-state-manager-c8832894.js","./buffer-barrier-8663498b.js","./mesh-8d5cf67e.js","./ZipUtils-50eca9c4.js","./deprecated-48c82c8e.js","./renderer-8d761016.js","./camera-component-67be14d4.js","./create-mesh-045e51ed.js","./deprecated-91fd6294.js","./model-renderer-0476c968.js","./touch-08df655d.js","./wasm-minigame-04dca4c4.js"],(function(t){"use strict";var e,r,i,a,s,n,o,l,h,p,c,u,d,f,m,y,_,g,v,S,F,C,D,P,T,b,R,A,x,V,w,I,E,U,O,M,k,L;return{setters:[function(t){e=t.ad,r=t.V,i=t.bF,a=t.B,s=t.bN,n=t.U,o=t.cK,l=t.cT,h=t.cU,p=t.bI,c=t.l,u=t.bE,d=t.bj,f=t.aM,m=t.c,y=t.bG,_=t.bX,g=t.f,v=t.e,S=t.d,F=t.bC,C=t.bH,D=t.bh,P=t.bi},function(t){T=t.o,b=t.i,R=t.a,A=t.b,x=t.f},function(t){V=t.b6,w=t.be,I=t.b0,E=t.b1},function(t){U=t.A,O=t.a},function(){},function(t){M=t.p},function(t){k=t._},function(t){L=t.c},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var N,B,z,G=e({GRAVITY:0,RADIUS:1}),W=e({FREE:0,RELATIVE:1,GROUPED:2}),j=new r(0,0),Y=new r,H=new r,X=new r,Z=new r,q=T(b),K=function(){this.pos=new r(0,0),this.startPos=new r(0,0),this.color=new a(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new r(0,0),this.aspectRatio=1,this.dir=new r(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},J=new(function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.get=function(){return this._get()||new K},e}(s))((function(t){t.pos.set(j),t.startPos.set(j),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(j),t.aspectRatio=1,t.dir.set(j),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),Q=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)J.put(t[e]);t.length=0,this.renderData.resize(0,0)},e.emitParticle=function(t){var e=this.sys,r=J.get();this.particles.push(r),r.timeToLive=e.life+e.lifeVar*(n()-.5)*2;var i=r.timeToLive=Math.max(0,r.timeToLive);r.pos.x=e.sourcePos.x+e.posVar.x*(n()-.5)*2,r.pos.y=e.sourcePos.y+e.posVar.y*(n()-.5)*2;var a,s,p,c,u=e.startColor,d=e.startColorVar,f=e.endColor,m=e.endColorVar;r.color.r=a=o(u.r+d.r*(n()-.5)*2,0,255),r.color.g=s=o(u.g+d.g*(n()-.5)*2,0,255),r.color.b=p=o(u.b+d.b*(n()-.5)*2,0,255),r.color.a=c=o(u.a+d.a*(n()-.5)*2,0,255),r.deltaColor.r=(o(f.r+m.r*(n()-.5)*2,0,255)-a)/i,r.deltaColor.g=(o(f.g+m.g*(n()-.5)*2,0,255)-s)/i,r.deltaColor.b=(o(f.b+m.b*(n()-.5)*2,0,255)-p)/i,r.deltaColor.a=(o(f.a+m.a*(n()-.5)*2,0,255)-c)/i;var y=e.startSize+e.startSizeVar*(n()-.5)*2;if(y=Math.max(0,y),r.size=y,-1===e.endSize)r.deltaSize=0;else{var _=e.endSize+e.endSizeVar*(n()-.5)*2;_=Math.max(0,_),r.deltaSize=(_-y)/i}var g=e.startSpin+e.startSpinVar*(n()-.5)*2,v=e.endSpin+e.endSpinVar*(n()-.5)*2;r.rotation=g,r.deltaRotation=(v-g)/i,r.startPos.x=t.x,r.startPos.y=t.y,r.aspectRatio=e.aspectRatio||1;var S=l(e.angle+this._worldRotation+e.angleVar*(n()-.5)*2);if(e.emitterMode===G.GRAVITY){var F=e.speed+e.speedVar*(n()-.5)*2;r.dir.x=Math.cos(S),r.dir.y=Math.sin(S),r.dir.multiplyScalar(F),r.radialAccel=e.radialAccel+e.radialAccelVar*(n()-.5)*2,r.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(n()-.5)*2,e.rotationIsDir&&(r.rotation=-h(Math.atan2(r.dir.y,r.dir.x)))}else{var C=e.startRadius+e.startRadiusVar*(n()-.5)*2,D=e.endRadius+e.endRadiusVar*(n()-.5)*2;r.radius=C,r.deltaRadius=-1===e.endRadius?0:(D-C)/i,r.angle=S,r.degreesPerSecond=l(e.rotatePerS+e.rotatePerSVar*(n()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var r=e.vData,i=this.sys._renderSpriteFrame.uv,a=t?0:this.uvFilled,s=this.particles.length,n=a;n<s;n++){var o=n*q*4;r[o+3]=i[0],r[o+4]=i[1],r[o+12]=i[2],r[o+13]=i[3],r[o+21]=i[4],r[o+22]=i[5],r[o+30]=i[6],r[o+31]=i[7]}this.uvFilled=s}},e.updateParticleBuffer=function(t,e,r,i){var s=r.vData,n=e.x,o=e.y,h=t.size,p=h,c=t.aspectRatio;c>1?p=h/c:h=p*c;var u=h/2,d=p/2;if(t.rotation){var f=-u,m=-d,y=u,_=d,g=-l(t.rotation),v=Math.cos(g),S=Math.sin(g);s[i]=f*v-m*S+n,s[i+1]=f*S+m*v+o,s[i+2]=0,s[i+9]=y*v-m*S+n,s[i+10]=y*S+m*v+o,s[i+11]=0,s[i+18]=f*v-_*S+n,s[i+19]=f*S+_*v+o,s[i+20]=0,s[i+27]=y*v-_*S+n,s[i+28]=y*S+_*v+o,s[i+29]=0}else s[i]=n-u,s[i+1]=o-d,s[i+2]=0,s[i+9]=n+u,s[i+10]=o-d,s[i+11]=0,s[i+18]=n-u,s[i+19]=o+d,s[i+20]=0,s[i+27]=n+u,s[i+28]=o+d,s[i+29]=0;a.toArray(s,t.color,i+5),a.toArray(s,t.color,i+14),a.toArray(s,t.color,i+23),a.toArray(s,t.color,i+32)},e.step=function(t){var e=this.sys.assembler,r=this.sys,i=r.node,a=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,i.updateWorldTransform(),r.positionType===W.FREE){this._worldRotation=function(t){for(var e=0,r=t;r;)e+=r.eulerAngles.z,r=r.parent;return e}(i);var s=i.worldMatrix;Y.x=s.m12,Y.y=s.m13}else r.positionType===W.RELATIVE?(this._worldRotation=i.eulerAngles.z,Y.x=i.position.x,Y.y=i.position.y):this._worldRotation=0;if(this.active&&r.emissionRate){var n=1/r.emissionRate;for(a.length<r.totalParticles&&(this.emitCounter+=t);a.length<r.totalParticles&&this.emitCounter>n;)this.emitParticle(Y),this.emitCounter-=n;this.elapsed+=t,-1!==r.duration&&r.duration<this.elapsed&&r.stopSystem()}var o=this.renderData,l=a.length;o.reset(),this.requestData(4*l,6*l),l>this.uvFilled&&this.updateUVs();for(var h=0;h<a.length;){H.x=H.y=X.x=X.y=Z.x=Z.y=0;var p=a[h];if(p.timeToLive-=t,p.timeToLive>0){if(r.emitterMode===G.GRAVITY){var c=Z,u=H,d=X;(p.pos.x||p.pos.y)&&(u.set(p.pos),u.normalize()),d.set(u),u.multiplyScalar(p.radialAccel);var f=d.x;d.x=-d.y,d.y=f,d.multiplyScalar(p.tangentialAccel),c.set(u),c.add(d),c.add(r.gravity),c.multiplyScalar(t),p.dir.add(c),c.set(p.dir),c.multiplyScalar(t),p.pos.add(c)}else p.angle+=p.degreesPerSecond*t,p.radius+=p.deltaRadius*t,p.pos.x=-Math.cos(p.angle)*p.radius,p.pos.y=-Math.sin(p.angle)*p.radius;p.color.r+=p.deltaColor.r*t,p.color.g+=p.deltaColor.g*t,p.color.b+=p.deltaColor.b*t,p.color.a+=p.deltaColor.a*t,p.size+=p.deltaSize*t,p.size<0&&(p.size=0),p.rotation+=p.deltaRotation*t;var m=H;m.set(p.pos),r.positionType!==W.GROUPED&&m.add(p.startPos);var y=q*h*4;this.updateParticleBuffer(p,m,o,y),++h}else{var _=a[h];h!==a.length-1&&(a[h]=a[a.length-1]),J.put(_),a.length--,o.resize(o.vertexCount-4,o.indexCount-6)}}this.renderData.material=this.sys.getRenderMaterial(0),this.renderData.frame=this.sys._renderSpriteFrame,o.setRenderDrawInfoAttributes(),0!==a.length||this.active||this.readyToPlay||(this.finished=!0,r._finishedSimulation())},e.requestData=function(t,e){var r=this.renderData.indexCount;this.renderData.request(t,e);for(var i=this.renderData.indexCount/6,a=this.renderData.iData,s=r;s<i;s++){var n=4*s;a[r++]=n,a[r++]=n+1,a[r++]=n+2,a[r++]=n+1,a[r++]=n+3,a[r++]=n+2}},e.initDrawInfo=function(){this.renderData.setRenderDrawInfoAttributes()},t}(),$=d,tt=t("ParticleAsset",u("cc.ParticleAsset")((B=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))||this).spriteFrame=z&&z(),e}return i(e,t),e}(U),z=p(B.prototype,"spriteFrame",[$],(function(){return null})),N=B))||N);c.ParticleAsset=tt;var et,rt,it,at,st,nt,ot,lt,ht,pt,ct,ut,dt,ft,mt,yt,_t,gt,vt,St,Ft,Ct,Dt,Pt,Tt,bt,Rt,At,xt,Vt,wt,It,Et,Ut,Ot,Mt,kt,Lt,Nt,Bt,zt,Gt,Wt,jt,Yt,Ht,Xt,Zt,qt,Kt,Jt,Qt,$t,te=function(){function t(t){var e,r=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var i=0,a=0,s=0;;){s=this.readUInt32();var n=function(){var t=[];for(i=0;i<4;++i)t.push(String.fromCharCode(r.data[r.pos++]));return t}.call(this).join("");switch(n){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var o=this.readUInt16(),l=this.readUInt16()||100;e.delay=1e3*o/l,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===n&&(this.pos+=4,s-=4),t=(null!=e?e.data:void 0)||this.imgData,i=0;s>=0?i<s:i>s;s>=0?++i:--i)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(s);var h=255-this.transparency.indexed.length;if(h>0)for(a=0;h>=0?a<h:a>h;h>=0?++a:--a)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":var p=this.read(s),c=p.indexOf(0),u=String.fromCharCode.apply(String,p.slice(0,c));this.text[u]=String.fromCharCode.apply(String,p.slice(c+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(r.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var d=this.colorType;this.hasAlphaChannel=4===d||6===d;var m=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*m,this.colorSpace=function(){switch(r.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=s}if(this.pos+=4,this.pos>this.data.length)throw new Error(f(6017))}}var e=t.prototype;return e.read=function(t){var e=0,r=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)r.push(this.data[this.pos++]);return r},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new k.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,r=e*this.width,i=new Uint8Array(r*this.height),a=t.length,s=0,n=0,o=0,l=0,h=0,p=0,c=0,u=0,d=0,m=0,y=0,_=0,g=0,v=0,S=0,F=0,C=0,D=0,P=0;n<a;){switch(t[n++]){case 0:for(p=c=0;c<r;p=c+=1)i[o++]=t[n++];break;case 1:for(p=u=0;u<r;p=u+=1)l=t[n++],_=p<e?0:i[o-e],i[o++]=(l+_)%256;break;case 2:for(p=d=0;d<r;p=d+=1)l=t[n++],h=(p-p%e)/e,D=s&&i[(s-1)*r+h*e+p%e],i[o++]=(D+l)%256;break;case 3:for(p=m=0;m<r;p=m+=1)l=t[n++],h=(p-p%e)/e,_=p<e?0:i[o-e],D=s&&i[(s-1)*r+h*e+p%e],i[o++]=(l+Math.floor((_+D)/2))%256;break;case 4:for(p=y=0;y<r;p=y+=1)l=t[n++],h=(p-p%e)/e,_=p<e?0:i[o-e],0===s?D=P=0:(D=i[(s-1)*r+h*e+p%e],P=h&&i[(s-1)*r+(h-1)*e+p%e]),g=_+D-P,v=Math.abs(g-_),F=Math.abs(g-D),C=Math.abs(g-P),S=v<=F&&v<=C?_:F<=C?D:P,i[o++]=(l+S)%256;break;default:throw new Error(f(6018,t[n-1]))}s++}return i},e.copyToImageData=function(t,e){var r,i=this.hasAlphaChannel,a=this.colors;this.palette.length&&(r=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),a=4,i=!0);var s=t.data||t,n=s.length,o=r||e,l=0,h=0,p=0,c=0;if(1===a)for(;l<n;)p=r?4*e[l/4]:h,c=o[p++],s[l++]=c,s[l++]=c,s[l++]=c,s[l++]=i?o[p++]:255,h=p;else for(;l<n;)p=r?4*e[l/4]:h,s[l++]=o[p++],s[l++]=o[p++],s[l++]=o[p++],s[l++]=i?o[p++]:255,h=p},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],r=new Uint8Array((e.length||0)+t.length),i=0,a=0,s=0,n=0,o=0,l=t.length;o<l;n=o+=3)r[i++]=t[n],r[i++]=t[n+1],r[i++]=t[n+2],s=e[a++],r[i++]=null!=s?s:255;return r},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),r=e.createImageData(this.width,this.height);return this.copyToImageData(r,this.decodePixels(null)),e.putImageData(r,0,0)},t}(),ee=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(f(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(f(6020));return!0},e.getFieldTypeName=function(t){return t in ie?ie[t]:null},e.getFieldTagName=function(t){return t in re?re[t]:(m(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,r,i){var a=[],s=this.getFieldTypeLength(e);if(s*r<=4)!1===this._littleEndian?a.push(i>>>8*(4-s)):a.push(i);else for(var n=0;n<r;n++){var o=s*n;s>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(a.push(this.getUint32(i+o)),a.push(this.getUint32(i+o+4))):m(8e3):a.push(this.getBytes(s,i+o))}return"ASCII"===e&&a.forEach((function(t,e,r){r[e]=String.fromCharCode(t)})),a},e.getBytes=function(t,e){if(t<=0)m(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);m(8002)}return 0},e.getBits=function(t,e,r){r=r||0;var i=e+Math.floor(r/8),a=r+t,s=32-t,n=0,o=0;return a<=0?m(6023):a<=8?(n=24+r,o=this.getUint8(i)):a<=16?(n=16+r,o=this.getUint16(i)):a<=32?(n=r,o=this.getUint32(i)):m(6022),{bits:o<<n>>>s,byteOffset:i+Math.floor(a/8),bitOffset:a%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),r=[],i=0,a=0;for(i=t+2,a=0;a<e;i+=12,a++){var s=this.getUint16(i),n=this.getUint16(i+2),o=this.getUint32(i+4),l=this.getUint32(i+8),h=this.getFieldTagName(s),p=this.getFieldTypeName(n),c=this.getFieldValues(h,p,o,l);r[h]={type:p,values:c}}this._fileDirectories.push(r);var u=this.getUint32(i);0!==u&&this.parseFileDirectory(u)},e.clampColorSample=function(t,e){var r=Math.pow(2,8-e);return Math.floor(t*r+(r-1))},e.parseTIFF=function(t,e){var r=this;if(e=e||y.document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var a=this._fileDirectories[0],s=a.ImageWidth.values[0],n=a.ImageLength.values[0];this._canvas.width=s,this._canvas.height=n;var o=[],l=a.Compression?a.Compression.values[0]:1,h=a.SamplesPerPixel.values[0],p=[],c=0,u=!1;a.BitsPerSample.values.forEach((function(t,e){p[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(p[e].hasBytesPerSample=!0,p[e].bytesPerSample=t/8),c+=t}),this);var d=0;c%8==0&&(u=!0,d=c/8);var _,g=a.StripOffsets.values,v=g.length;if(a.StripByteCounts)_=a.StripByteCounts.values;else{if(m(8003),1!==v)throw Error(f(6024));_=[Math.ceil(s*n*c/8)]}for(var S=1,F=1,C=0;C<v;C++){var D=g[C];o[C]=[];for(var P=_[C],T=0,b=0,R=1,A=!0,x=[],V=0,w=0,I=0;T<P;T+=R)switch(l){case 1:x=[];for(var E=0;E<h;E++){var U=p[E];if(!U.hasBytesPerSample){var O=this.getBits(U.bitsPerSample,D+T,b);throw x.push(O.bits),T=O.byteOffset-D,b=O.bitOffset,RangeError(f(6025))}var M=U.bytesPerSample*E;x.push(this.getBytes(U.bytesPerSample,D+T+M))}if(o[C].push(x),!u)throw R=0,RangeError(f(6026));R=d;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(A){A=!1;var k=this.getUint8(D+T);k>=0&&k<=127?S=k+1:k>=-127&&k<=-1?F=1-k:A=!0}else{for(var L=this.getUint8(D+T),N=0;N<F;N++){var B=p[w];if(!B.hasBytesPerSample)throw RangeError(f(6025));I=I<<8*V|L,++V===B.bytesPerSample&&(x.push(I),I=V=0,w++),w===h&&(o[C].push(x),x=[],w=0)}0==--S&&(A=!0)}R=1}}if(e.getContext){var z=this._canvas.getContext("2d");z.fillStyle="rgba(255, 255, 255, 0)";var G=a.RowsPerStrip?a.RowsPerStrip.values[0]:n,W=o.length,j=n%G,Y=0===j?G:j,H=G,X=0,Z=a.PhotometricInterpretation.values[0],q=[],K=0;a.ExtraSamples&&(q=a.ExtraSamples.values,K=q.length);var J=[],Q=0;a.ColorMap&&(J=a.ColorMap.values,Q=Math.pow(2,p[0].bitsPerSample));for(var $=0;$<W;$++){$+1===W&&(H=Y);for(var tt=o[$].length,et=X*$,rt=0,it=0;rt<H&&it<tt;rt++)for(var at=function(){var t=o[$][it],e=0,i=0,a=0,s=1;if(K>0)for(var n=0;n<K;n++)if(1===q[n]||2===q[n]){s=t[3+n]/256;break}switch(Z){case 0:var l=0;p[0].hasBytesPerSample&&(l=Math.pow(16,2*p[0].bytesPerSample)),t.forEach((function(t,e,r){r[e]=l-t}));case 1:e=i=a=r.clampColorSample(t[0],p[0].bitsPerSample);break;case 2:e=r.clampColorSample(t[0],p[0].bitsPerSample),i=r.clampColorSample(t[1],p[1].bitsPerSample),a=r.clampColorSample(t[2],p[2].bitsPerSample);break;case 3:if(void 0===J)throw Error(f(6027));var h=t[0];e=r.clampColorSample(J[h],16),i=r.clampColorSample(J[Q+h],16),a=r.clampColorSample(J[2*Q+h],16);break;default:throw RangeError(f(6028,Z))}z.fillStyle="rgba("+e+", "+i+", "+a+", "+s+")",z.fillRect(st,et+rt,1,1)},st=0;st<s;st++,it++)at();X=H}}return this._canvas}},t}(),re={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},ie={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"};function ae(t){var e=t.parent,r=t.getComponent(ye);return e&&r?ae(e):t.getComponentsInChildren(ye)}!function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}($t||($t={}));var se,ne,oe,le,he,pe,ce,ue,de,fe,me,ye=t("ParticleSystem2D",(et=u("cc.ParticleSystem2D"),rt=_(tt),it=_(R),at=_(W),st=_(G),nt=P("preview"),et(((Qt=function(t){function e(){var e;return(e=t.call(this)||this).duration=ht&&ht(),e.emissionRate=pt&&pt(),e.life=ct&&ct(),e.lifeVar=ut&&ut(),e.angle=dt&&dt(),e.angleVar=ft&&ft(),e.startSize=mt&&mt(),e.startSizeVar=yt&&yt(),e.endSize=_t&&_t(),e.endSizeVar=gt&&gt(),e.startSpin=vt&&vt(),e.startSpinVar=St&&St(),e.endSpin=Ft&&Ft(),e.endSpinVar=Ct&&Ct(),e.sourcePos=Dt&&Dt(),e.posVar=Pt&&Pt(),e.emitterMode=Tt&&Tt(),e.gravity=bt&&bt(),e.speed=Rt&&Rt(),e.speedVar=At&&At(),e.tangentialAccel=xt&&xt(),e.tangentialAccelVar=Vt&&Vt(),e.radialAccel=wt&&wt(),e.radialAccelVar=It&&It(),e.rotationIsDir=Et&&Et(),e.startRadius=Ut&&Ut(),e.startRadiusVar=Ot&&Ot(),e.endRadius=Mt&&Mt(),e.endRadiusVar=kt&&kt(),e.rotatePerS=Lt&&Lt(),e.rotatePerSVar=Nt&&Nt(),e.aspectRatio=1,e.playOnLoad=Bt&&Bt(),e.autoRemoveOnFinish=zt&&zt(),e._preview=Gt&&Gt(),e._custom=Wt&&Wt(),e._file=jt&&jt(),e._spriteFrame=Yt&&Yt(),e._totalParticles=Ht&&Ht(),e._startColor=Xt&&Xt(),e._startColorVar=Zt&&Zt(),e._endColor=qt&&qt(),e._endColorVar=Kt&&Kt(),e._positionType=Jt&&Jt(),e._stopped=!0,e._useFile=void 0,e.initProperties(),e._useFile=!1,e}i(e,t);var r=e.prototype;return r.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial(),this._updatePositionType()},r.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this._simulator.renderData&&this._assembler&&this._assembler.removeData(this._simulator.renderData)},r.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new Q(this)},r.onFocusInEditor=function(){this._focused=!0;for(var t=ae(this.node),e=0;e<t.length;++e)t[e]._startPreview()},r.onLostFocusInEditor=function(){this._focused=!1;for(var t=ae(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},r._startPreview=function(){this._preview&&this.resetSystem()},r._stopPreview=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},r.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},r._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this),this._simulator.renderData.particleInitRenderDrawInfo(this.renderEntity),this._simulator.initDrawInfo())},r.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},r.addParticle=function(){},r.stopSystem=function(){this._stopped=!0,this._simulator.stop()},r.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this.markForUpdateRenderData()},r.isFull=function(){return this.particleCount>=this.totalParticles},r._applyFile=function(){var t=this._file;if(t){if(!t)return void g(6029);if(!this.isValid)return;this._plistFile=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}},r._initTextureWithDictionary=function(t){var e,r=this;if(t.spriteFrameUuid){var i=t.spriteFrameUuid;V.loadAny(i,(function(e,i){e?(t.spriteFrameUuid=void 0,r._initTextureWithDictionary(t),v(e)):r.spriteFrame=i}))}else{var a=O(this._plistFile,t.textureFileName||"");if(t.textureFileName)V.loadRemote(a,(function(e,i){e?(t.textureFileName=void 0,r._initTextureWithDictionary(t),v(e)):r.spriteFrame=i?R.createWithImage(i):R.createWithImage(w.get("white-texture"))}));else if(t.textureImageData){var s=t.textureImageData;if(!(s&&s.length>0))return!1;var n=a;this.file&&(n+="-"+this.file.uuid);var o=V.assets.get(n);if(!o){var l=L.unzipBase64AsArray(s,1);if(!l)return S(6030,this._file.name),!1;var h=(e=l).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?$t.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?$t.TIFF:$t.UNKNOWN;if(h!==$t.TIFF&&h!==$t.PNG)return S(6031,this._file.name),!1;var p=y.document.createElement("canvas");h===$t.PNG?new te(l).render(p):(this._tiffReader||(this._tiffReader=new ee),this._tiffReader.parseTIFF(l,p)),o=new I(p),V.assets.add(n,o)}o||S(6032,this._file.name),this.spriteFrame=o?R.createWithImage(o):R.createWithImage(w.get("white-texture"))}}return!0},r._initWithDictionary=function(t){this._useFile=!0,this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this._srcBlendFactor=parseInt(t.blendFuncSource||M.SRC_ALPHA),this._dstBlendFactor=parseInt(t.blendFuncDestination||M.ONE_MINUS_SRC_ALPHA);var r=this._startColor;r.r=255*parseFloat(t.startColorRed||0),r.g=255*parseFloat(t.startColorGreen||0),r.b=255*parseFloat(t.startColorBlue||0),r.a=255*parseFloat(t.startColorAlpha||0);var i=this._startColorVar;i.r=255*parseFloat(t.startColorVarianceRed||0),i.g=255*parseFloat(t.startColorVarianceGreen||0),i.b=255*parseFloat(t.startColorVarianceBlue||0),i.a=255*parseFloat(t.startColorVarianceAlpha||0);var a=this._endColor;a.r=255*parseFloat(t.finishColorRed||0),a.g=255*parseFloat(t.finishColorGreen||0),a.b=255*parseFloat(t.finishColorBlue||0),a.a=255*parseFloat(t.finishColorAlpha||0);var s=this._endColorVar;if(s.r=255*parseFloat(t.finishColorVarianceRed||0),s.g=255*parseFloat(t.finishColorVarianceGreen||0),s.b=255*parseFloat(t.finishColorVarianceBlue||0),s.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:W.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||G.GRAVITY),this.emitterMode===G.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var n=t.rotationIsDir||"";null!==n?(n=n.toString().toLowerCase(),this.rotationIsDir="true"===n||"1"===n):this.rotationIsDir=!1}else{if(this.emitterMode!==G.RADIUS)return S(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},r._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},r._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator&&this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this.markForUpdateRenderData()):this.resetSystem()},r._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},r._updateMaterial=function(){if(this._customMaterial){this.setSharedMaterial(this._customMaterial,0);var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];this._dstBlendFactor=t.blendDst,this._srcBlendFactor=t.blendSrc}var e=this.getMaterialInstance(0);e&&e.recompileShaders({USE_LOCAL:this._positionType!==W.FREE}),e&&e.passes.length>0&&this._updateBlendFunc()},r._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this.markForUpdateRenderData(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},r._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&null!==this._renderSpriteFrame&&void 0!==this._renderSpriteFrame},r._render=function(t){this._positionType===W.RELATIVE?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===W.GROUPED?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)},r._updatePositionType=function(){this._positionType===W.RELATIVE?(this._renderEntity.setRenderTransform(this.node.parent),this._renderEntity.setUseLocal(!0)):this.positionType===W.GROUPED?(this._renderEntity.setRenderTransform(this.node),this._renderEntity.setUseLocal(!0)):(this._renderEntity.setRenderTransform(null),this._renderEntity.setUseLocal(!1))},F(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile(),this._updateMaterial())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial(),this._updatePositionType()}},{key:"preview",get:function(){return this._preview},set:function(t){t?this._startPreview():this._stopPreview(),this._preview=t}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(A)).EmitterMode=G,Qt.PositionType=W,Qt.DURATION_INFINITY=-1,Qt.START_SIZE_EQUAL_TO_END_SIZE=-1,Qt.START_RADIUS_EQUAL_TO_END_RADIUS=-1,C((lt=Qt).prototype,"file",[rt],Object.getOwnPropertyDescriptor(lt.prototype,"file"),lt.prototype),C(lt.prototype,"spriteFrame",[it],Object.getOwnPropertyDescriptor(lt.prototype,"spriteFrame"),lt.prototype),ht=p(lt.prototype,"duration",[d],(function(){return-1})),pt=p(lt.prototype,"emissionRate",[d],(function(){return 10})),ct=p(lt.prototype,"life",[d],(function(){return 1})),ut=p(lt.prototype,"lifeVar",[d],(function(){return 0})),C(lt.prototype,"color",[D],Object.getOwnPropertyDescriptor(lt.prototype,"color"),lt.prototype),dt=p(lt.prototype,"angle",[d],(function(){return 90})),ft=p(lt.prototype,"angleVar",[d],(function(){return 20})),mt=p(lt.prototype,"startSize",[d],(function(){return 50})),yt=p(lt.prototype,"startSizeVar",[d],(function(){return 0})),_t=p(lt.prototype,"endSize",[d],(function(){return 0})),gt=p(lt.prototype,"endSizeVar",[d],(function(){return 0})),vt=p(lt.prototype,"startSpin",[d],(function(){return 0})),St=p(lt.prototype,"startSpinVar",[d],(function(){return 0})),Ft=p(lt.prototype,"endSpin",[d],(function(){return 0})),Ct=p(lt.prototype,"endSpinVar",[d],(function(){return 0})),Dt=p(lt.prototype,"sourcePos",[d],(function(){return r.ZERO.clone()})),Pt=p(lt.prototype,"posVar",[d],(function(){return r.ZERO.clone()})),C(lt.prototype,"positionType",[at],Object.getOwnPropertyDescriptor(lt.prototype,"positionType"),lt.prototype),Tt=p(lt.prototype,"emitterMode",[d,st],(function(){return G.GRAVITY})),bt=p(lt.prototype,"gravity",[d],(function(){return r.ZERO.clone()})),Rt=p(lt.prototype,"speed",[d],(function(){return 180})),At=p(lt.prototype,"speedVar",[d],(function(){return 50})),xt=p(lt.prototype,"tangentialAccel",[d],(function(){return 80})),Vt=p(lt.prototype,"tangentialAccelVar",[d],(function(){return 0})),wt=p(lt.prototype,"radialAccel",[d],(function(){return 0})),It=p(lt.prototype,"radialAccelVar",[d],(function(){return 0})),Et=p(lt.prototype,"rotationIsDir",[d],(function(){return!1})),Ut=p(lt.prototype,"startRadius",[d],(function(){return 0})),Ot=p(lt.prototype,"startRadiusVar",[d],(function(){return 0})),Mt=p(lt.prototype,"endRadius",[d],(function(){return 0})),kt=p(lt.prototype,"endRadiusVar",[d],(function(){return 0})),Lt=p(lt.prototype,"rotatePerS",[d],(function(){return 0})),Nt=p(lt.prototype,"rotatePerSVar",[d],(function(){return 0})),Bt=p(lt.prototype,"playOnLoad",[d],(function(){return!0})),zt=p(lt.prototype,"autoRemoveOnFinish",[d],(function(){return!1})),Gt=p(lt.prototype,"_preview",[nt],(function(){return!0})),Wt=p(lt.prototype,"_custom",[d],(function(){return!1})),jt=p(lt.prototype,"_file",[d],(function(){return null})),Yt=p(lt.prototype,"_spriteFrame",[d],(function(){return null})),Ht=p(lt.prototype,"_totalParticles",[d],(function(){return 150})),Xt=p(lt.prototype,"_startColor",[d],(function(){return new a(255,255,255,255)})),Zt=p(lt.prototype,"_startColorVar",[d],(function(){return new a(0,0,0,0)})),qt=p(lt.prototype,"_endColor",[d],(function(){return new a(255,255,255,0)})),Kt=p(lt.prototype,"_endColorVar",[d],(function(){return new a(0,0,0,0)})),Jt=p(lt.prototype,"_positionType",[d],(function(){return W.FREE})),ot=lt))||ot)),_e=function(){function t(t,e){this.point=new r,this.dir=new r,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),ge=t("MotionStreak",(se=u("cc.MotionStreak"),ne=_(E),se(((me=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))||this)._preview=he&&he(),e._fadeTime=pe&&pe(),e._minSeg=ce&&ce(),e._stroke=ue&&ue(),e._texture=de&&de(),e._fastMode=fe&&fe(),e._points=[],e}i(e,t);var r=e.prototype;return r.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},r._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material,this._updateColor())},r.onFocusInEditor=function(){this._preview&&this.reset()},r.onLostFocusInEditor=function(){this._preview&&this.reset()},r.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},r.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},r._render=function(t){t.commitComp(this,this._renderData,this._texture,this._assembler,null)},F(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(A)).Point=_e,C((le=me).prototype,"texture",[ne],Object.getOwnPropertyDescriptor(le.prototype,"texture"),le.prototype),he=p(le.prototype,"_preview",[d],(function(){return!1})),pe=p(le.prototype,"_fadeTime",[d],(function(){return 1})),ce=p(le.prototype,"_minSeg",[d],(function(){return 1})),ue=p(le.prototype,"_stroke",[d],(function(){return 64})),de=p(le.prototype,"_texture",[d],(function(){return null})),fe=p(le.prototype,"_fastMode",[d],(function(){return!1})),oe=le))||oe));new r;var ve,Se=new r,Fe=new r;function Ce(t,e){return t.x=-e.y,t.y=e.x,t}var De={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,42),e},update:function(t,e){var i,a=t.stroke/2,s=t.node.worldMatrix,n=s.m12,o=s.m13,l=t.points;if(l.length>1){var h=l[0],p=h.point.x-n,c=h.point.y-o;p*p+c*c<t.minSeg&&(i=h)}i||(i=new ge.Point,l.unshift(i)),i.setPoint(n,o),i.time=t.fadeTime+e;var u,d=0;if(!(l.length<2)){var f=t.renderData;this.updateRenderDataCache(t,f);var m=t.color,y=m.r,_=m.g,g=m.b,v=m.a,S=l[1];S.distance=r.subtract(Fe,i.point,S.point).length(),Fe.normalize(),S.setDir(Fe.x,Fe.y),i.setDir(Fe.x,Fe.y),f.dataLength=2*l.length;for(var F=f.data,C=t.fadeTime,D=!1,P=l.length-1;P>=0;P--){var T=l[P],b=T.point,R=T.dir;if(T.time-=e,T.time<0)l.splice(P,1);else{var A=T.time/C,x=l[P-1];if(!D){if(!x){l.splice(P,1);continue}b.x=x.point.x-R.x*A,b.y=x.point.y-R.y*A}D=!0,Ce(Se,R);var V=(A*v<<24>>>0)+(g<<16)+(_<<8)+y,w=d;F[w].x=b.x+Se.x*a,F[w].y=b.y+Se.y*a,F[w].u=1,F[w].v=A,F[w].color._val=V,F[w+=1].x=b.x-Se.x*a,F[w].y=b.y-Se.y*a,F[w].u=0,F[w].v=A,F[w].color._val=V,d+=2}}u=d<=2?0:3*(d-2),f.resize(d,u)}},updateWorldVertexAllData:function(t){for(var e=t.renderData,r=e.floatStride,i=e.data,s=e.chunk.vb,n=0;n<i.length;n++){var o=n*r;s[o+0]=i[n].x,s[o+1]=i[n].y,s[o+2]=i[n].z,s[o+3]=i[n].u,s[o+4]=i[n].v,a.toArray(s,i[n].color,o+5)}},createQuadIndices:function(t,e){var r=t.renderData.chunk.meshBuffer.indexOffset;ve=null,ve=new Uint16Array(e);for(var i=0,a=e;i<a;i+=2){var s=0+i;ve[r++]=s,ve[r++]=s+2,ve[r++]=s+1,ve[r++]=s+1,ve[r++]=s+2,ve[r++]=s+3}},updateRenderDataCache:function(t,e){e.passDirty&&e.updatePass(t),e.nodeDirty&&e.updateNode(t),e.textureDirty&&t.texture&&(e.updateTexture(t.texture),e.material=t.getRenderMaterial(0)),e.hashDirty&&e.updateHash()},updateRenderData:function(){},updateColor:function(){},fillBuffers:function(t){for(var e=t.renderData,r=e.chunk,i=e.data,s=e.vertexCount,n=e.indexCount,o=r.vb,l=0,h=0;h<s;h++){var p=i[h];o[l++]=p.x,o[l++]=p.y,o[l++]=p.z,o[l++]=p.u,o[l++]=p.v,a.toArray(o,p.color,l),l+=4}r.bufferId;for(var c=r.vertexOffset,u=r.meshBuffer,d=r.meshBuffer.iData,f=u.indexOffset,m=0,y=n;m<y;m+=2){var _=c+m;d[f++]=_,d[f++]=_+2,d[f++]=_+1,d[f++]=_+1,d[f++]=_+2,d[f++]=_+3}u.indexOffset+=e.indexCount,u.setDirty()}},Pe=t("MotionStreakAssemblerManager",{getAssembler:function(){return De}});ge.Assembler=Pe;var Te={maxParticleDeltaTime:0,createData:function(){return x.add()},removeData:function(t){x.remove(t)},updateRenderData:function(){},fillBuffers:function(){}},be=t("ParticleSystem2DAssembler",{getAssembler:function(){return Te.maxParticleDeltaTime||(Te.maxParticleDeltaTime=c.game.frameTime/1e3*2),Te}});ye.Assembler=be}}}));
