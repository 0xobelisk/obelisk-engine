System.register(["./index-2b176ebe.js","./index-433d8403.js","./wasm-minigame-04dca4c4.js","./deprecated-48c82c8e.js","./director-c293a59c.js","./sprite-renderer-6181a621.js","./sprite-c357d031.js","./deprecated-6137537d.js","./pipeline-state-manager-c8832894.js","./node-event-0336ef70.js","./collision-matrix-00c79502.js","./buffer-barrier-8663498b.js","./touch-08df655d.js","./renderer-8d761016.js","./camera-component-67be14d4.js","./create-mesh-045e51ed.js","./mesh-8d5cf67e.js","./deprecated-91fd6294.js","./model-renderer-0476c968.js","./deprecated-6c3e37bc.js"],(function(t,i){"use strict";var e,n,o,r,s,a,c,l,u,h,d,f,y,_,p,g,m,x,b,v,w,S,P,A,C,B,D,T,j,M,F,G,L,V,k,R;return{setters:[function(t){e=t.d,n=t.f,o=t.C,r=t.g,s=t.E,a=t.i,c=t.R,l=t.n,u=t.s},function(t){h=t.a,d=t.e,f=t.V,y=t.B,_=t.o,p=t.av,g=t.O,m=t.Q,x=t.cA,b=t.bC,v=t.T,w=t.H,S=t.N,P=t.y,A=t.bF,C=t.w},function(t){B=t.e,t.i},function(t){D=t.g,T=t.G},function(t){j=t.az,M=t.aU,F=t.ax},function(t){G=t.C},function(){},function(t){L=t.G},function(t){V=t.b},function(t){k=t.N},function(t){R=t.P},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var t={};function I(t){return t?t.$$.ptr:0}var E=new Map;function W(t,i,e){if(e){var n=E.get(t);n||(n=new Map,E.set(t,n)),n.set(e,i)}}function q(t,i){if(i){var e=E.get(t);e&&e.has(i)&&(e.delete(i),0===e.size&&E.delete(t))}}function O(t,i){var e=E.get(t);return null==e?void 0:e.get(i)}var N,J=new Map;function z(t,i,e){if(e){var n=J.get(t);n||(n=new Map,J.set(t,n)),n.set(e,i)}}function H(t,i){if(i){var e=J.get(t);e&&e.has(i)&&(e.delete(i),0===e.size&&J.delete(t))}}function U(t,i,e){e.x=t.q.c*i.x-t.q.s*i.y+t.p.x,e.y=t.q.s*i.x+t.q.c*i.y+t.p.y}D.onPostInfrastructureInitDelegate.add((function(){return B().then((function(){return i.import("./box2d.release.asm-1b284544.js").then((function(i){return e=i.default,new Promise((function(i,n){e().then((function(i){h("[box2d]:box2d asm lib loaded."),t=i})).then(i).catch((function(t){return n(function(t){return"[box2d]: box2d asm lib load failed: "+t}(t))}))}));var e}))})).catch((function(t){d(t)}))}));var Q,Y=function(){function t(){}return t.BeginContact=function(t){this._BeginContact&&this._BeginContact(t)},t.EndContact=function(t){this._EndContact&&this._EndContact(t)},t.PreSolve=function(t,i){this._PreSolve&&this._PreSolve(t,i)},t.PostSolve=function(t,i){this._PostSolve&&this._PostSolve(t,i)},t}();N=Y,Y._BeginContact=null,Y._EndContact=null,Y._PreSolve=null,Y._PostSolve=null,Y.callback={BeginContact:function(t){N.BeginContact(t)},EndContact:function(t){N.EndContact(t)},PreSolve:function(t,i){N.PreSolve(t,i)},PostSolve:function(t,i){N.PostSolve(t,i)}};var X,Z=function(){function i(){}return i.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},i.ReportFixture=function(i){return this._isPoint?t.FixtureTestPoint(i,this._point)&&this._fixtures.push(i):this._fixtures.push(i),!0},i.getFixture=function(){return this._fixtures[0]},i.getFixtures=function(){return this._fixtures},i}();Q=Z,Z._point={x:0,y:0},Z._isPoint=!1,Z._fixtures=[],Z.callback={ReportFixture:function(t){return Q.ReportFixture(t)}};var K=function(){function i(){}return i.init=function(t,e){i._type=t,i._mask=e,i._fixtures.length=0,i._points.length=0,i._normals.length=0,i._fractions.length=0},i.ReportFixture=function(n,o,r,s){return 0==(t.FixtureGetFilterData(n).categoryBits&i._mask)?0:i._type===e.Closest?(i._fixtures[0]=n,i._points[0]=o,i._normals[0]=r,i._fractions[0]=s,s):(i._fixtures.push(n),i._points.push(new f(o.x,o.y)),i._normals.push(new f(r.x,r.y)),i._fractions.push(s),i._type===e.Any?0:i._type>=e.All?1:s)},i.getFixtures=function(){return i._fixtures},i.getPoints=function(){return i._points},i.getNormals=function(){return i._normals},i.getFractions=function(){return i._fractions},i}();X=K,K._type=e.Closest,K._fixtures=[],K._points=[],K._normals=[],K._fractions=[],K._mask=4294967295,K.callback={ReportFixture:function(t,i,e,n){return X.ReportFixture(t,i,e,n)}};var $,tt=[],it=[new f,new f],et={points:[],separations:[],normal:new f},nt=function(){this.localPoint=new f,this.normalImpulse=0,this.tangentImpulse=0},ot=[new nt,new nt],rt={type:0,localPoint:new f,localNormal:new f,points:[]},st={normalImpulses:[],tangentImpulses:[]},at=function(){function i(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this.disabledOnce=!1,this._impulsePtr=0,this._inverted=!1,this._implPtr=0,this._b2WorldmanifoldPtr=0}i.get=function(t){var e=tt.pop();return e||(e=new i),e.init(t),e},i.put=function(t){var i=O(2,t);i&&(tt.push(i),i.reset())};var e=i.prototype;return e._setImpulse=function(t){this._impulsePtr=t},e.init=function(i){var e=t.ContactGetFixture(i);this.colliderA=O(0,e.x).collider,this.colliderB=O(0,e.y).collider,this.disabled=!1,this.disabledOnce=!1,this._impulsePtr=0,this._inverted=!1,this._implPtr=i,W(2,this,this._implPtr),this._b2WorldmanifoldPtr=t.WorldManifoldNew()},e.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulsePtr=0,q(2,this._implPtr),this._implPtr=0,t.WorldManifoldDelete(this._b2WorldmanifoldPtr),this._b2WorldmanifoldPtr=0},e.getWorldManifold=function(){var i=et.points,e=et.separations,o=et.normal;t.ContactGetWorldManifold(this._implPtr,this._b2WorldmanifoldPtr);var r=t.ContactGetManifold(this._implPtr),s=t.ManifoldGetPointCount(r);i.length=e.length=s;for(var a=0;a<s;a++){var c=it[a];c.x=t.WorldManifoldGetPointValueX(this._b2WorldmanifoldPtr,a)*n,c.y=t.WorldManifoldGetPointValueY(this._b2WorldmanifoldPtr,a)*n,i[a]=c,e[a]=t.WorldManifoldGetSeparationValue(this._b2WorldmanifoldPtr,a)*n}return o.x=t.WorldManifoldGetNormalValueX(this._b2WorldmanifoldPtr),o.y=t.WorldManifoldGetNormalValueY(this._b2WorldmanifoldPtr),this._inverted&&(o.x*=-1,o.y*=-1),et},e.getManifold=function(){for(var i=rt.points,e=rt.localNormal,o=rt.localPoint,r=t.ContactGetManifold(this._implPtr),s=i.length=t.ManifoldGetPointCount(r),a=0;a<s;a++){var c=ot[a],l=t.ManifoldGetManifoldPointPtr(r,a);c.localPoint.x=t.ManifoldPointGetLocalPointX(l)*n,c.localPoint.y=t.ManifoldPointGetLocalPointY(l)*n,c.normalImpulse=t.ManifoldPointGetNormalImpulse(l)*n,c.tangentImpulse=t.ManifoldPointGetTangentImpulse(l),i[a]=c}return o.x=t.ManifoldGetLocalPointValueX(r)*n,o.y=t.ManifoldGetLocalPointValueY(r)*n,e.x=t.ManifoldGetLocalNormalValueX(r),e.y=t.ManifoldGetLocalNormalValueY(r),rt.type=t.ManifoldGetType(r),this._inverted&&(e.x*=-1,e.y*=-1),rt},e.getImpulse=function(){var i=this._impulsePtr;if(!i)return null;for(var e=st.normalImpulses,o=st.tangentImpulses,r=t.ContactImpulseGetCount(i),s=0;s<r;s++)e[s]=t.ContactImpulseGetNormalImpulse(i,s)*n,o[s]=t.ContactImpulseGetTangentImpulse(i,s);return o.length=e.length=r,st},e.emit=function(t){switch(t){case o.BEGIN_CONTACT:case o.END_CONTACT:case o.PRE_SOLVE:case o.POST_SOLVE:}var i=this.colliderA,e=this.colliderB,n=i.body,s=e.body;n.enabledContactListener&&(null==i||i.emit(t,i,e,this)),s.enabledContactListener&&(null==e||e.emit(t,e,i,this)),(n.enabledContactListener||s.enabledContactListener)&&r.instance.emit(t,i,e,this),(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},e.setEnabled=function(i){t.ContactSetEnabled(this._implPtr,i)},e.isTouching=function(){return t.ContactIsTouching(this._implPtr)},e.setTangentSpeed=function(i){t.ContactSetTangentSpeed(this._implPtr,i)},e.getTangentSpeed=function(){return t.ContactGetTangentSpeed(this._implPtr)},e.setFriction=function(i){t.ContactSetFriction(this._implPtr,i)},e.getFriction=function(){return t.ContactGetFriction(this._implPtr)},e.resetFriction=function(){t.ContactResetFriction(this._implPtr)},e.setRestitution=function(i){t.ContactSetRestitution(this._implPtr,i)},e.getRestitution=function(){return t.ContactGetRestitution(this._implPtr)},e.resetRestitution=function(){t.ContactResetRestitution(this._implPtr)},i}(),ct={x:0,y:0},lt={x:0,y:0},ut=new y,ht=y.GREEN,dt=y.RED,ft=function(){function i(){}i._DrawPolygon=function(e,o){for(var r=i._drawer,s=t.HEAPF32.subarray(e/4,e/4+2*o),a=0;a<o;a++){ct.x=s[2*a+0],ct.y=s[2*a+1],U(i._xf,ct,lt);var c=lt.x*n,l=lt.y*n;0===a?r.moveTo(c,l):r.lineTo(c,l)}r.close()},i.DrawPolygon=function(t,e,n){i._applyStrokeColor(n),i._DrawPolygon(t,e),i._drawer.stroke()},i.DrawSolidPolygon=function(t,e,n){i._applyFillColor(n),i._DrawPolygon(t,e),i._drawer.fill(),i._drawer.stroke()},i._DrawCircle=function(t,e){U(i._xf,t,lt),i._drawer.circle(lt.x*n,lt.y*n,e*n)},i.DrawCircle=function(t,e,n){i._applyStrokeColor(n),i._DrawCircle(t,e),i._drawer.stroke()},i.DrawSolidCircle=function(t,e,n,o){i._applyFillColor(o),i._DrawCircle(t,e),i._drawer.fill()},i.DrawSegment=function(t,e,o){var r=i._drawer;if(t.x===e.x&&t.y===e.y)return i._applyFillColor(o),i._DrawCircle(t,2/n),void r.fill();i._applyStrokeColor(o),U(i._xf,t,ct),r.moveTo(ct.x*n,ct.y*n),U(i._xf,e,ct),r.lineTo(ct.x*n,ct.y*n),r.stroke()},i.DrawTransform=function(t){var e=i._drawer;e.strokeColor=dt,ct.x=ct.y=0,U(t,ct,lt),e.moveTo(lt.x*n,lt.y*n),ct.x=1,ct.y=0,U(t,ct,lt),e.lineTo(lt.x*n,lt.y*n),e.stroke(),e.strokeColor=ht,ct.x=ct.y=0,U(t,ct,lt),e.moveTo(lt.x*n,lt.y*n),ct.x=0,ct.y=1,U(t,ct,lt),e.lineTo(lt.x*n,lt.y*n),e.stroke()},i.DrawPoint=function(){},i.DrawParticles=function(){},i._applyStrokeColor=function(t){i._drawer.strokeColor=ut.set(255*t.r,255*t.g,255*t.b,150)},i._applyFillColor=function(t){i._drawer.fillColor=ut.set(255*t.r,255*t.g,255*t.b,150)};var e=i.prototype;return e.PushTransform=function(t){i._xf=t},e.PopTransform=function(){i._xf=i._dxf},i}();$=ft,ft.callback={DrawPolygon:function(t,i,e){$.DrawPolygon(t,i,e)},DrawSolidPolygon:function(t,i,e){$.DrawSolidPolygon(t,i,e)},DrawCircle:function(t,i,e){$.DrawCircle(t,i,e)},DrawSolidCircle:function(t,i,e,n){$.DrawSolidCircle(t,i,e,n)},DrawSegment:function(t,i,e){$.DrawSegment(t,i,e)},DrawTransform:function(t){$.DrawTransform(t)},DrawPoint:function(t,i,e){$.DrawPoint(t,i,e)}},ft._drawer=null,ft._xf={p:{x:0,y:0},q:{s:0,c:1}},ft._dxf={p:{x:0,y:0},q:{s:0,c:1}};var yt=new _,_t=new f,pt=new f,gt=[],mt=function(){function i(){this._world=void 0,this._bodies=[],this._animatedBodies=[],this._rotationAxis=new _,this._physicsGroundBody=void 0,this._contactListener=void 0,this._aabbQueryCallback=void 0,this._raycastQueryCallback=void 0,this._temoBodyDef=void 0,this._tempB2AABB=void 0,this.tempB2FixtureDefPtr=void 0,this._debugGraphics=null,this._b2DebugDrawer=null,this._debugDrawFlags=0,this._world=new t.World({x:0,y:-10}),this._physicsGroundBody=this._world.CreateBody(new t.BodyDef),Y._BeginContact=this._onBeginContact,Y._EndContact=this._onEndContact,Y._PreSolve=this._onPreSolve,Y._PostSolve=this._onPostSolve,this._contactListener=t.ContactListener.implement(Y.callback),this._world.SetContactListener(this._contactListener),this._aabbQueryCallback=t.QueryCallback.implement(Z.callback),this._raycastQueryCallback=t.RayCastCallback.implement(K.callback),this._temoBodyDef=new t.BodyDef,this._tempB2AABB=new t.AABB,this.tempB2FixtureDefPtr=t.FixtureDefNew()}var r=i.prototype;return r._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var i=j("Canvas");if(!i){var e=M.getScene();if(!e)return;(i=new F("Canvas")).addComponent(G),i.parent=e}var n=new F("PHYSICS_2D_DEBUG_DRAW");n.hideFlags|=p.Flags.DontSave,n.parent=i,n.worldPosition=_.ZERO,n.layer=V.Enum.UI_2D,this._debugGraphics=n.addComponent(L),this._debugGraphics.lineWidth=3,ft._drawer=this._debugGraphics;var o=t.Draw.implement(ft.callback);this._b2DebugDrawer=o,this._world.SetDebugDraw(o)}var r=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(r.children.length-1),this._b2DebugDrawer&&this._b2DebugDrawer.SetFlags(this.debugDrawFlags)},r.setGravity=function(t){this._world.SetGravity(t)},r.setAllowSleep=function(){this._world.SetAllowSleeping(!0)},r.step=function(t,i,e){void 0===i&&(i=10),void 0===e&&(e=10);for(var n=this._animatedBodies,o=0,r=n.length;o<r;o++)n[o].animate(t);this._world.Step(t,i,e)},r.raycast=function(t,i,o,r){if(t.equals(i))return[];o=o||e.Closest,_t.x=t.x/n,_t.y=t.y/n,pt.x=i.x/n,pt.y=i.y/n,K.init(o,r),this._world.RayCast(this._raycastQueryCallback,_t,pt);var s=K.getFixtures();if(s.length>0){for(var a=K.getPoints(),c=K.getNormals(),l=K.getFractions(),u=[],h=0,d=s.length;h<d;h++){var y=s[h],_=O(0,y),p=_.collider;if(o===e.AllClosest){for(var g=void 0,m=0;m<u.length;m++)u[m].collider===p&&(g=u[m]);if(g){l[h]<g.fraction&&(g.fixtureIndex=_.getFixtureIndex(y),g.point.x=a[h].x*n,g.point.y=a[h].y*n,g.normal.x=c[h].x,g.normal.y=c[h].y,g.fraction=l[h]);continue}}u.push({collider:p,fixtureIndex:_.getFixtureIndex(y),point:new f(a[h].x*n,a[h].y*n),normal:new f(c[h].x,c[h].y),fraction:l[h]})}return u}return[]},r.syncPhysicsToScene=function(){for(var t=this._bodies,i=0,e=t.length;i<e;i++){var o=t[i],r=o.rigidBody;if(r.type!==s.Animated){var a=r.node,c=o.impl,l=c.GetPosition();yt.x=l.x*n,yt.y=l.y*n,yt.z=0,a.worldPosition=yt;var u=g(c.GetAngle());a.setWorldRotationFromEuler(0,0,u)}else o.resetVelocity()}},r.syncSceneToPhysics=function(){for(var t=this._bodies,i=0;i<t.length;i++)t[i].syncSceneToPhysics()},r.addBody=function(i){if(!this._bodies.includes(i)){var e=this._temoBodyDef,o=i.rigidBody;e.allowSleep=o.allowSleep,e.gravityScale=o.gravityScale,e.linearDamping=o.linearDamping,e.angularDamping=o.angularDamping,e.fixedRotation=o.fixedRotation,e.bullet=o.bullet;var r=o.node,a=r.worldPosition;if(e.position={x:a.x/n,y:a.y/n},yt.z=m.getAxisAngle(this._rotationAxis,r.worldRotation),this._rotationAxis.z<0&&(yt.z=2*Math.PI-yt.z),e.angle=yt.z,e.awake=o.awakeOnLoad,o.type===s.Animated)e.type=t.BodyType.b2_kinematicBody,this._animatedBodies.push(i),i._animatedPos.set(e.position.x,e.position.y),i._animatedAngle=e.angle;else switch(o.type){case s.Dynamic:e.type=t.BodyType.b2_dynamicBody;break;case s.Static:e.type=t.BodyType.b2_staticBody;break;case s.Kinematic:e.type=t.BodyType.b2_kinematicBody;break;default:e.type=t.BodyType.b2_staticBody}var c=o,l=c._linearVelocity;e.linearVelocity={x:l.x,y:l.y},e.angularVelocity=c._angularVelocity;var u=this._world.CreateBody(e);W(1,i,I(u)),z(1,u,I(u)),i._imp=u,this._bodies.push(i)}},r.removeBody=function(t){this._bodies.includes(t)&&(t.impl&&(q(1,I(t.impl)),H(1,I(t.impl)),this._world.DestroyBody(t.impl),t._imp=null),x(this._bodies,t),t.rigidBody.type===s.Animated&&x(this._animatedBodies,t))},r.registerContactFixture=function(t){this._contactListener.registerContactFixture(t)},r.unregisterContactFixture=function(t){this._contactListener.unregisterContactFixture(t)},r.testPoint=function(t){var i=_t.x=t.x/n,e=_t.y=t.y/n,o=.2/n;this._tempB2AABB.lowerBound={x:i-o,y:e-o},this._tempB2AABB.upperBound={x:i+o,y:e+o};var r=this._aabbQueryCallback;Z.init(_t),this._world.QueryAABB(r,this._tempB2AABB);var s=Z.getFixtures();gt.length=0;for(var a=0;a<s.length;a++){var c=O(0,s[a]).collider;gt.includes(c)||gt.push(c)}return gt},r.testAABB=function(t){this._tempB2AABB.lowerBound={x:t.xMin/n,y:t.yMin/n},this._tempB2AABB.upperBound={x:t.xMax/n,y:t.yMax/n};var i=this._aabbQueryCallback;Z.init(),this._world.QueryAABB(i,this._tempB2AABB);var e=Z.getFixtures();gt.length=0;for(var o=0;o<e.length;o++){var r=O(0,e[o]).collider;gt.includes(r)||gt.push(r)}return gt},r.drawDebug=function(){this._checkDebugDrawValid(),this._debugGraphics&&(this._debugGraphics.clear(),this._world.DebugDraw())},r._onBeginContact=function(t){at.get(t).emit(o.BEGIN_CONTACT)},r._onEndContact=function(t){var i=O(2,t);i&&(i.emit(o.END_CONTACT),at.put(t))},r._onPreSolve=function(t){var i=O(2,t);i&&i.emit(o.PRE_SOLVE)},r._onPostSolve=function(t,i){var e=O(2,t);e&&(e._setImpulse(i),e.emit(o.POST_SOLVE),e._setImpulse(0))},b(i,[{key:"impl",get:function(){return this._world}},{key:"groundBodyImpl",get:function(){return this._physicsGroundBody}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){t||this._debugGraphics&&(this._debugGraphics.node.parent=null),this._debugDrawFlags=t}}]),i}(),xt=new _,bt={x:0,y:0},vt={x:0,y:0},wt=function(){function i(){this._animatedPos=new f,this._animatedAngle=0,this._body=null,this._rigidBody=void 0,this._inited=!1}var e=i.prototype;return e.initialize=function(t){this._rigidBody=t,r.instance._callAfterStep(this,this._init)},e.onDestroy=function(){r.instance._callAfterStep(this,this._destroy)},e.onEnable=function(){this.setActive(!0)},e.onDisable=function(){this.setActive(!1)},e.nodeTransformChanged=function(t){if(!r.instance.stepping){if(t&F.TransformBit.SCALE)for(var i=this.rigidBody.getComponents(a),e=0;e<i.length;e++)i[e].apply();t&F.TransformBit.POSITION&&this.syncPositionToPhysics(!0),t&F.TransformBit.ROTATION&&this.syncRotationToPhysics(!0)}},e._init=function(){this._inited||(r.instance.physicsWorld.addBody(this),this.setActive(!1),this._inited=!0)},e._destroy=function(){var i,e;if(this._inited){var n=null===(i=this.impl)||void 0===i?void 0:i.GetFixtureList();if(n)for(var o=O(0,n);o&&o.impl;){o.destroy(),o=O(0,t.FixtureGetNext(n))}var s=null===(e=this.impl)||void 0===e?void 0:e.GetJointList();if(s)for(var a=t.JointEdgeGetJoint(s),c=O(0,a);c;)c.destroy(),c=O(0,a=t.JointEdgeGetNext(s));r.instance.physicsWorld.removeBody(this),this._inited=!1}},e.animate=function(t){var i=this._body;if(i){var e=i.GetPosition();i.SetAwake(!0);var n=1/t;bt.x=(this._animatedPos.x-e.x)*n,bt.y=(this._animatedPos.y-e.y)*n,i.SetLinearVelocity(bt);var o=i.GetAngle()%v;o>Math.PI&&(o-=v);var r=(this._animatedAngle-o)*n;this._animatedAngle<-w&&o>w&&(r=(this._animatedAngle+v-o)*n),this._animatedAngle>w&&o<-w&&(r=(this._animatedAngle-v-o)*n),i.SetAngularVelocity(r)}},e.syncSceneToPhysics=function(){var t=this._rigidBody.node.hasChangedFlags;t&&this.nodeTransformChanged(t)},e.syncPositionToPhysics=function(t){void 0===t&&(t=!1);var i=this._body;if(i){var e=this._rigidBody.node.worldPosition;vt.x=e.x/n,vt.y=e.y/n,this._rigidBody.type===s.Animated&&t?this._animatedPos.set(vt.x,vt.y):i.SetTransform(vt,i.GetAngle())}},e.syncRotationToPhysics=function(t){void 0===t&&(t=!1);var i=this._body;if(i){var e=this._rigidBody.node.worldRotation,n=xt;m.toEulerInYXZOrder(n,e);var o=S(n.z);this._rigidBody.type===s.Animated&&t?this._animatedAngle=o:i.SetTransform(i.GetPosition(),o)}},e.resetVelocity=function(){var t=this._body;t&&(bt.x=0,bt.y=0,t.SetLinearVelocity(bt),t.SetAngularVelocity(0))},e.setType=function(i){i===s.Dynamic?this._body.SetType(t.BodyType.b2_dynamicBody):i===s.Kinematic?this._body.SetType(t.BodyType.b2_kinematicBody):i===s.Static&&this._body.SetType(t.BodyType.b2_staticBody)},e.setLinearDamping=function(t){this._body.SetLinearDamping(t)},e.setAngularDamping=function(t){this._body.SetAngularDamping(t)},e.setGravityScale=function(t){this._body.SetGravityScale(t)},e.setFixedRotation=function(t){this._body.SetFixedRotation(t)},e.setAllowSleep=function(t){this._body.SetSleepingAllowed(t)},e.isActive=function(){return this._body.IsEnabled()},e.setActive=function(t){this._body.SetEnabled(t)},e.wakeUp=function(){this._body.SetAwake(!0)},e.sleep=function(){this._body.SetAwake(!1)},e.getMass=function(){return this._body.GetMass()},e.setLinearVelocity=function(t){this._body.SetLinearVelocity(t)},e.getLinearVelocity=function(t){var i=this._body.GetLinearVelocity();return t.x=i.x,t.y=i.y,t},e.getLinearVelocityFromWorldPoint=function(t,i){i=i||new f,bt.x=t.x/n,bt.y=t.y/n;var e=this._body.GetLinearVelocityFromWorldPoint(bt);return i.x=e.x*n,i.y=e.y*n,i},e.setAngularVelocity=function(t){this._body.SetAngularVelocity(t)},e.getAngularVelocity=function(){return this._body.GetAngularVelocity()},e.getLocalVector=function(t,i){i=i||new f,bt.x=t.x/n,bt.y=t.y/n;var e=this._body.GetLocalVector(bt);return i.x=e.x*n,i.y=e.y*n,i},e.getWorldVector=function(t,i){bt.x=t.x/n,bt.y=t.y/n;var e=this._body.GetWorldVector(bt);return i.x=e.x*n,i.y=e.y*n,i},e.getLocalPoint=function(t,i){i=i||new f,bt.x=t.x/n,bt.y=t.y/n;var e=this._body.GetLocalPoint(bt);return i.x=e.x*n,i.y=e.y*n,i},e.getWorldPoint=function(t,i){i=i||new f,bt.x=t.x/n,bt.y=t.y/n;var e=this._body.GetWorldPoint(bt);return i.x=e.x*n,i.y=e.y*n,i},e.getLocalCenter=function(t){t=t||new f;var i=this._body.GetLocalCenter();return t.x=i.x*n,t.y=i.y*n,t},e.getWorldCenter=function(t){t=t||new f;var i=this._body.GetWorldCenter();return t.x=i.x*n,t.y=i.y*n,t},e.getInertia=function(){return this._body.GetInertia()},e.applyForce=function(t,i,e){this._body&&(bt.x=i.x/n,bt.y=i.y/n,this._body.ApplyForce(t,bt,e))},e.applyForceToCenter=function(t,i){this._body&&this._body.ApplyForceToCenter(t,i)},e.applyTorque=function(t,i){this._body&&this._body.ApplyTorque(t,i)},e.applyLinearImpulse=function(t,i,e){this._body&&(bt.x=i.x/n,bt.y=i.y/n,this._body.ApplyLinearImpulse(t,bt,e))},e.applyLinearImpulseToCenter=function(t,i){this._body&&this._body.ApplyLinearImpulse(t,this._body.GetPosition(),i)},e.applyAngularImpulse=function(t,i){this._body&&this._body.ApplyAngularImpulse(t,i)},b(i,[{key:"impl",get:function(){return this._body}},{key:"_imp",set:function(t){this._body=t}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"isAwake",get:function(){return this._body.IsAwake()}},{key:"isSleeping",get:function(){return!this._body.IsAwake()}}]),i}(),St={categoryBits:0,maskBits:0,groupIndex:0},Pt={x:0,y:0},At={x:0,y:0};function Ct(t){var i=t.collider;return i.body?St.categoryBits=i.group===R.DEFAULT?i.body.group:i.group:St.categoryBits=i.group,St.maskBits=r.instance.collisionMatrix[St.categoryBits],St}var Bt=function(){function i(){this._shapes=[],this._fixtures=[],this._collider=null,this._body=null,this._inited=!1,this._rect=new P}var e=i.prototype;return e.initialize=function(t){this._collider=t},e.onLoad=function(){},e.onEnable=function(){r.instance._callAfterStep(this,this._init)},e.onDisable=function(){r.instance._callAfterStep(this,this.destroy)},e.start=function(){},e.onGroupChanged=function(){var i=Ct(this);this._fixtures.forEach((function(e){t.FixtureSetFilterData(e,i)}))},e.apply=function(){this.destroy(),this.collider.enabledInHierarchy&&this._init()},e.getFixtureIndex=function(t){return this._fixtures.indexOf(t)},e._createShapes=function(){return[]},e._init=function(){if(!this._inited){var i=this.collider,e=i.node.worldScale,n=_.ZERO,o=i.getComponent(c);o&&o.impl&&o.impl.impl?this._body=o.impl.impl:(this._body=r.instance.physicsWorld.groundBodyImpl,n=i.node.worldPosition);for(var s=0===e.x&&0===e.y?[]:this._createShapes(e.x,e.y,n.x,n.y),a=Ct(this),l=0;l<s.length;l++){var u=s[l],h=r.instance.physicsWorld.tempB2FixtureDefPtr;t.FixtureDefSetAll(h,u,0,i.friction,i.restitution,i.density,i.sensor,a.categoryBits,a.maskBits,a.groupIndex);var d=t.BodyCreateFixture(I(this._body),h);W(0,this,d),z(0,d,d),null!=o&&o.enabledContactListener&&r.instance.physicsWorld.registerContactFixture(d),this._shapes.push(u),this._fixtures.push(d)}this._inited=!0}},e.destroy=function(){if(this._inited){for(var i=this._fixtures,e=this._body,n=i.length-1;n>=0;n--){var o=i[n];q(0,o),H(0,o),r.instance.physicsWorld.unregisterContactFixture(o),e&&t.BodyDestroyFixture(I(e),o)}this._body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},b(i,[{key:"impl",get:function(){return this._shapes}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){for(var i=1e7,e=i,o=i,r=-i,s=-i,a=this._fixtures,c=0;c<a.length;c++)for(var l=a[c],u=t.FixtureGetShape(l),h=t.ShapeGetChildCount(u),d=0;d<h;d++){var f=t.FixtureGetAABB(l,d);if(Pt.x=f.lowerBound.x,Pt.y=f.lowerBound.y,At.x=f.upperBound.x,At.y=f.upperBound.y,2===t.ShapeGetType(u)){var y=t.ShapeGetRadius(u);Pt.x+=y,Pt.y+=y,At.x+=y,At.y+=y}Pt.x<e&&(e=Pt.x),Pt.y<o&&(o=Pt.y),At.x>r&&(r=At.x),At.y>s&&(s=At.y)}e*=n,o*=n,r*=n,s*=n;var _=this._rect;return _.x=e,_.y=o,_.width=r-e,_.height=s-o,_}}]),i}(),Dt=new P,Tt=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._worldPoints=[new f,new f,new f,new f],t}return A(e,i),e.prototype._createShapes=function(i,e,o,r){i=Math.abs(i),e=Math.abs(e);var s=this.collider,a=s.size.width/2/n*i,c=s.size.height/2/n*e,l=(o+s.offset.x*i)/n,u=(r+s.offset.y*e)/n,h=t.PolygonShapeNew();return t.PolygonShapeSetAsBoxWithCenterAndAngle(h,a,c,l,u,0),[h]},b(e,[{key:"worldPoints",get:function(){var t=Dt,i=this.collider,e=i.size,n=i.offset;t.x=n.x-e.width/2,t.y=n.y-e.height/2,t.width=e.width,t.height=e.height;var o=this._worldPoints,r=o[0],s=o[1],a=o[2],c=o[3];return t.transformMat4ToPoints(i.node.worldMatrix,r,s,a,c),o}}]),e}(Bt),jt=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._worldPosition=new f,t}return A(e,i),e.prototype._createShapes=function(i,e,o,r){i=Math.abs(i),e=Math.abs(e);var s=this.collider,a=(o+s.offset.x*i)/n,c=(r+s.offset.y*e)/n,l=t.CircleShapeNew();return t.ShapeSetRadius(l,s.radius/n*i),t.CircleShapeSetPosition(l,a,c),[l]},b(e,[{key:"worldRadius",get:function(){return t.CircleShapeGetRadius(this._shapes[0])*n}},{key:"worldPosition",get:function(){var i=t.CircleShapeGetPosition(this._shapes[0]);return this._worldPosition.set(i.x*n,i.y*n)}}]),e}(Bt),Mt=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._worldPoints=[],t}return A(e,i),e.prototype._createShapes=function(i,e,o,r){var s=[],a=this.collider,c=a.points;c.length>0&&c[0].equals(c[c.length-1])&&(c.length-=1);var u=l(c);if(!u)return C("[Physics2D] b2PolygonShape failed to decompose polygon into convex polygons, node name: ",a.node.name),s;for(var h=a.offset,d=0;d<u.length;d++){for(var f=u[d],y=0,_=t.Vec2VectorNew(),p=null,g=0,m=f.length;g<m;g++){y||(y=t.PolygonShapeNew());var x=f[g],b=(o+(x.x+h.x)*i)/n,v=(r+(x.y+h.y)*e)/n,w={x:b,y:v};if(t.Vec2VectorPush(_,b,v),p||(p=w),t.Vec2VectorSize(_)===t.maxPolygonVertices&&(t.PolygonShapeSet(y,t.Vec2VectorGetPtr(_),t.Vec2VectorSize(_)),s.push(y),y=0,g<m-1)){var S=t.Vec2VectorGet(_,t.Vec2VectorSize(_)-1);t.Vec2VectorResize(_,0,0,0),t.Vec2VectorPush(_,p.x,p.y),t.Vec2VectorPush(_,S.x,S.y)}}y&&(t.PolygonShapeSet(y,t.Vec2VectorGetPtr(_),t.Vec2VectorSize(_)),s.push(y)),t.Vec2VectorDelete(_)}return s},b(e,[{key:"worldPoints",get:function(){for(var t=this.collider,i=t.points,e=this._worldPoints,n=t.node.worldMatrix,o=0;o<i.length;o++)e[o]||(e[o]=new f),f.transformMat4(e[o],i[o],n);return e.length=i.length,this._worldPoints}}]),e}(Bt),Ft=function(){function t(){this._b2joint=null,this._jointComp=null,this._body=null,this._inited=!1}var i=t.prototype;return i.initialize=function(t){this._jointComp=t},i.onEnable=function(){r.instance._callAfterStep(this,this._init)},i.onDisable=function(){r.instance._callAfterStep(this,this.destroy)},i.start=function(){r.instance._callAfterStep(this,this._init)},i.apply=function(){r.instance._callAfterStep(this,this.destroy),this.comp.enabledInHierarchy&&r.instance._callAfterStep(this,this._init)},i._init=function(){if(!this._inited){var t=this._jointComp;if(t.isValid)if(this._body=t.getComponent(c),this._body){var i=this._createJointDef();if(i){i.SetBodyA(this._body.impl.impl);var e=t.connectedBody;e&&!e.enabledInHierarchy||(e?i.SetBodyB(e.impl.impl):i.SetBodyB(r.instance.physicsWorld.groundBodyImpl),i.collideConnected=t.collideConnected,this._b2joint=r.instance.physicsWorld.impl.CreateJoint(i),W(3,this,I(this._b2joint)),z(3,this._b2joint,I(this._b2joint)),this._inited=!0)}}else C("Joint2D: Body is not found, can not create joint. Node Name: "+t.node.name)}},i.destroy=function(){this._inited&&(q(3,I(this._b2joint)),H(3,I(this._b2joint)),r.instance.physicsWorld.impl.DestroyJoint(this._b2joint),this._b2joint=null,this._inited=!1)},i._createJointDef=function(){return null},i.isValid=function(){return this._b2joint&&this._body&&this._body.impl&&this._jointComp},b(t,[{key:"impl",get:function(){return this._b2joint}},{key:"comp",get:function(){return this._jointComp}},{key:"body",get:function(){return this._body}}]),t}(),Gt={x:0,y:0},Lt=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._touchPoint=new f,t._isTouched=!1,t}A(e,i);var o=e.prototype;return o.setTarget=function(t){this._b2joint&&(Gt.x=t.x/n,Gt.y=t.y/n,this._b2joint.SetTarget(Gt))},o.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},o.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},o._createJointDef=function(){var i=new t.MouseJointDef,e=this._jointComp;return i.target={x:this._touchPoint.x/n,y:this._touchPoint.y/n},i.maxForce=e.maxForce,i.dampingRatio=e.dampingRatio,i.frequencyHz=e.frequency,i},o.initialize=function(t){i.prototype.initialize.call(this,t);var e=j("Canvas");e&&(e.on(k.TOUCH_START,this.onTouchBegan,this),e.on(k.TOUCH_MOVE,this.onTouchMove,this),e.on(k.TOUCH_END,this.onTouchEnd,this),e.on(k.TOUCH_CANCEL,this.onTouchEnd,this))},o.onEnable=function(){},o.start=function(){},o.onTouchBegan=function(t){this._isTouched=!0;var i=this._touchPoint.set(t.getUILocation()),e=r.instance.physicsWorld.testPoint(i);if(!(e.length<=0)){var n=e[0].body;n.wakeUp();var o=this._jointComp;o.connectedBody=n,this._init(),this.setMaxForce(o.maxForce*n.getMass()),this.setTarget(i)}},o.onTouchMove=function(t){this._touchPoint=t.getUILocation()},o.onTouchEnd=function(){this.destroy(),this._isTouched=!1},o.update=function(){this._isTouched&&this.isValid()&&this.setTarget(this._touchPoint)},e}(Ft),Vt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setMaxLength=function(t){this._b2joint&&this._b2joint.SetMaxLength(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.RopeJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.maxLength=i.maxLength/n,e},e}(Ft),kt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},o.setDistance=function(t){this._b2joint&&this._b2joint.SetLength(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.DistanceJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.length=i.distance/n,e.dampingRatio=i.dampingRatio,e.frequencyHz=i.frequency,e},e}(Ft),Rt={x:0,y:0},It=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},o.setAngularOffset=function(t){this._b2joint&&this._b2joint.SetAngularOffset(S(t))},o.setLinearOffset=function(t){this._b2joint&&(Rt.x=t.x/n,Rt.y=t.y/n,this._b2joint.SetLinearOffset(Rt))},o.setCorrectionFactor=function(t){this._b2joint&&this._b2joint.SetCorrectionFactor(t)},o.setMaxTorque=function(t){this._b2joint&&this._b2joint.SetMaxTorque(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.MotorJointDef;return e.linearOffset={x:i.linearOffset.x/n,y:i.linearOffset.y/n},e.angularOffset=S(i.angularOffset),e.maxForce=i.maxForce,e.maxTorque=i.maxTorque,e.correctionFactor=i.correctionFactor,e},e}(Ft),Et=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},o.setLowerLimit=function(){this.updateLimits()},o.setUpperLimit=function(){this.updateLimits()},o.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(t.lowerLimit/n,t.upperLimit/n)}},o.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},o.setMaxMotorForce=function(t){this._b2joint&&this._b2joint.SetMaxMotorForce(t)},o.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.PrismaticJointDef;e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n};var o=S(i.angle);return e.localAxisA={x:Math.cos(o),y:Math.sin(o)},e.referenceAngle=0,e.enableLimit=i.enableLimit,e.lowerTranslation=i.lowerLimit/n,e.upperTranslation=i.upperLimit/n,e.enableMotor=i.enableMotor,e.maxMotorForce=i.maxMotorForce,e.motorSpeed=i.motorSpeed,e},e}(Ft),Wt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.WeldJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.referenceAngle=0,e.dampingRatio=i.dampingRatio,e.frequencyHz=i.frequency,e},e}(Ft),qt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setFrequency=function(t){this._b2joint&&this._b2joint.SetSpringFrequencyHz(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetSpringDampingRatio(t)},o.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},o.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},o.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.WheelJointDef;e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n};var o=S(i.angle);return e.localAxisA={x:Math.cos(o),y:Math.sin(o)},e.maxMotorTorque=i.maxMotorTorque,e.motorSpeed=S(i.motorSpeed),e.enableMotor=i.enableMotor,e.dampingRatio=i.dampingRatio,e.frequencyHz=i.frequency,e},e}(Ft),Ot=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},o.setLowerAngle=function(){this.updateLimits()},o.setUpperAngle=function(){this.updateLimits()},o.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(S(t.lowerAngle),S(t.upperAngle))}},o.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},o.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},o.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.RevoluteJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.enableMotor=i.enableMotor,e.maxMotorTorque=i.maxMotorTorque,e.motorSpeed=S(i.motorSpeed),e.enableLimit=i.enableLimit,e.lowerAngle=S(i.lowerAngle),e.upperAngle=S(i.upperAngle),e},e}(Ft);D.once(T.EVENT_PRE_SUBSYSTEM_INIT,(function(){u.register("box2d-wasm",{PhysicsWorld:mt,RigidBody:wt,BoxShape:Tt,CircleShape:jt,PolygonShape:Mt,MouseJoint:Lt,DistanceJoint:Vt,SpringJoint:kt,RelativeJoint:It,SliderJoint:Et,FixedJoint:Wt,WheelJoint:qt,HingeJoint:Ot})}))}}}));
