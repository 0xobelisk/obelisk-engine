System.register(["./index-433d8403.js","./node-event-0336ef70.js","./director-c293a59c.js","./pipeline-state-manager-c8832894.js","./buffer-barrier-8663498b.js","./deprecated-48c82c8e.js","./renderer-8d761016.js","./camera-component-67be14d4.js","./create-mesh-045e51ed.js","./deprecated-91fd6294.js","./model-renderer-0476c968.js"],(function(t){"use strict";var e,i,n,r,s,a,o,h,u,c,_,l,f,d,p,v,y,m,g,x,S,D,E,w,R,A,C,T,I,b,P,F,O,B,k,M,N,L,z,U,V,H,G,X,W,Y,j,q,K,Q,Z,J,$,tt,et,it,nt,rt,st,at,ot,ht,ut,ct,_t,lt,ft,dt,pt,vt,yt,mt,gt,xt,St,Dt,Et,wt,Rt,At,Ct,Tt,It,bt,Pt,Ft;return{setters:[function(t){e=t.bF,i=t.l,n=t.aQ,r=t.cm,s=t.bC,a=t.b3,o=t.o,h=t.t,u=t.bE,c=t.y,_=t.q,l=t.V,f=t.S,d=t.f,p=t.bG,v=t.d,y=t.bz,m=t.aM,g=t.aP,x=t.P,S=t.g,D=t.B,E=t.R,w=t.cu,R=t.I,A=t.aR,C=t.c5,T=t.bI,I=t.cx,b=t.F,P=t.bj,F=t.ae,O=t.bX,B=t.bH,k=t.bh,M=t.cJ,N=t.am,L=t.cl,z=t.aO,U=t.b2,V=t.b1,H=t.cf,G=t.b,X=t.aH,W=t.ad,Y=t.c6,j=t.ak,q=t.aj,K=t.al,Q=t.ct},function(t){Z=t.A,J=t.N,$=t.C},function(t){tt=t.bH,et=t.b1,it=t.bI,nt=t.aU,rt=t.b0,st=t.aT,at=t.bQ,ot=t.be,ht=t.b4,ut=t.h,ct=t.aD},function(t){_t=t.a0},function(t){lt=t.a3,ft=t.v,dt=t.aq,pt=t.aP,vt=t.b,yt=t.aQ,mt=t.a9,gt=t.d,xt=t.f,St=t.as,Dt=t.n,Et=t.ba,wt=t.o,Rt=t.bk,At=t.p,Ct=t.q,Tt=t.r},function(){},function(t){It=t.R},function(t){bt=t.C},function(t){Pt=t._},function(){},function(t){Ft=t.M}],execute:function(){t({j:Jt,o:Zt});var Ot=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var i=new Bt;i.initWithSize(t,e),this._texture=i,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,n=t.texture,r=this._innerTextureInfos[n.getId()],s=e.x,a=e.y;if(r)s+=r.x,a+=r.y;else{var o=n.width,h=n.height;if(this._x+o+2>this._width&&(this._x=2,this._y=this._nexty),this._y+h+2>this._nexty&&(this._nexty=this._y+h+2),this._nexty>this._height)return null;i.internal.dynamicAtlasManager.textureBleeding&&((o<=8||h<=8)&&(this._texture.drawTextureAt(n.image,this._x-1,this._y-1),this._texture.drawTextureAt(n.image,this._x-1,this._y+1),this._texture.drawTextureAt(n.image,this._x+1,this._y-1),this._texture.drawTextureAt(n.image,this._x+1,this._y+1)),this._texture.drawTextureAt(n.image,this._x-1,this._y),this._texture.drawTextureAt(n.image,this._x+1,this._y),this._texture.drawTextureAt(n.image,this._x,this._y-1),this._texture.drawTextureAt(n.image,this._x,this._y+1)),this._texture.drawTextureAt(n.image,this._x,this._y),this._innerTextureInfos[n.getId()]={x:this._x,y:this._y,texture:n},this._count++,s+=this._x,a+=this._y,this._x+=o+2}var u={x:s,y:a,texture:this._texture};return this._innerSpriteFrames.push(t),u},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var n=t[e];n.isValid&&n._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),Bt=function(t){function i(){return t.apply(this,arguments)||this}e(i,t);var n=i.prototype;return n.initWithSize=function(t,e,i){void 0===i&&(i=tt.RGBA8888),this.reset({width:t,height:e,format:i})},n.drawTextureAt=function(t,e,i){var n=this.getGFXTexture();if(t&&n){var r=this._getGFXDevice();if(r){var s=new lt;s.texOffset.x=e,s.texOffset.y=i,s.texExtent.width=t.width,s.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],n,[s])}else console.warn("Unable to get device")}},i}(et),kt=t("D",function(t){function a(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._atlases=[],e._atlasIndex=-1,e._maxAtlasCount=5,e._textureSize=2048,e._maxFrameSize=512,e._textureBleeding=!0,e._enabled=!1,e}e(a,t);var o=a.prototype;return o.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new Ot(this._textureSize,this._textureSize),this._atlases.push(t)),t},o.beforeSceneLoad=function(){this.reset()},o.init=function(){this.enabled=!n.CLEANUP_IMAGE_CACHE},o.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=t.texture.getSamplerInfo();if(e.minFilter!==it.LINEAR||e.magFilter!==it.LINEAR||e.mipFilter!==it.NONE)return null;var i=this._atlases[this._atlasIndex];i||(i=this.newAtlas());var n=i.insertSpriteFrame(t);return n||this._atlasIndex===this._maxAtlasCount?n:(i=this.newAtlas()).insertSpriteFrame(t)},o.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},o.deleteAtlasSpriteFrame=function(t){if(t._original){for(var e,i=this._atlases.length-1;i>=0;i--)e=this._atlases[i],r(e._innerSpriteFrames,t);var n=t._original._texture;this.deleteAtlasTexture(n)}},o.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},o.packToDynamicAtlas=function(t,e){if(this._enabled&&e&&!e._original&&e.packable&&e.texture&&e.texture.width>0&&e.texture.height>0){var i=this.insertSpriteFrame(e);i&&e._setDynamicAtlasFrame(i)}},s(a,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),i.director.on(i.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),i.director.off(i.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),a}(a));kt.instance=void 0;var Mt,Nt,Lt=t("g",kt.instance=new kt);nt.registerSystem("dynamicAtlasManager",Lt,0),i.internal.dynamicAtlasManager=Lt;var zt,Ut=new o,Vt=new h;!function(t){t[t.RECT=0]="RECT",t[t.POLYGON=1]="POLYGON"}(zt||(zt={}));var Ht=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],Gt=t("a",u("cc.SpriteFrame")(((Nt=function(t){function i(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.unbiasUV=[],e.uvSliced=[],e._rect=new c,e._trimmedBorder=new _,e._offset=new l,e._originalSize=new f,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e._pixelsToUnit=100,e._pivot=new l(.5,.5),e._meshType=zt.RECT,e._extrude=0,e._customOutLine=[],e._minPos=new o,e._maxPos=new o,e}e(i,t),i.createWithImage=function(t){var e=t instanceof rt?t:new rt(t),n=new et;n.image=e;var r=new i;return r.texture=n,r};var n=i.prototype;return n.textureLoaded=function(){return!!this.texture},n.isRotated=function(){return this._rotated},n.setRotated=function(t){this.rotated=t},n.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},n.setRect=function(t){this.rect=t},n.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},n.setOriginalSize=function(t){this.originalSize=t},n.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},n.setOffset=function(t){this.offset=t},n.getGFXTexture=function(){return this._texture.getGFXTexture()},n.getGFXSampler=function(){return this._texture.getGFXSampler()},n.getHash=function(){return this._texture.getHash()},n.getSamplerInfo=function(){return this._texture.getSamplerInfo()},n.reset=function(t,e){void 0===e&&(e=!1);var i=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,i=!0),t&&(t.texture&&(this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),i=!0),i&&this.texture&&this._calculateUV(),this._calcTrimmedBorder()},n.checkRect=function(t){var e=this._rect,i=e.x,n=e.y;return this._rotated?(i+=e.height,n+=e.width):(i+=e.width,n+=e.height),i>t.width?(d(3300,this.name+"/"+t.name,i,t.width),!1):!(n>t.height&&(d(3301,this.name+"/"+t.name,n,t.height),1))},n._calcTrimmedBorder=function(){var t=this._originalSize.width,e=this._originalSize.height,i=.5*(t-this._rect.width),n=.5*(e-this._rect.height);this._trimmedBorder.x=this._offset.x+i,this._trimmedBorder.y=this._offset.x-i,this._trimmedBorder.z=this._offset.y+n,this._trimmedBorder.w=this._offset.y-n},n.ensureMeshData=function(){this._mesh||(this._initVertices(),this._createMesh())},n.destroy=function(){return this._packable&&Lt&&Lt.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},n._calculateSlicedUV=function(){var t=this._rect,e=this.texture,n=e.width,r=e.height,s=this._capInsets[0],a=this._capInsets[2],o=t.width-s-a,h=this._capInsets[1],u=this._capInsets[3],c=t.height-h-u,_=this.uvSliced;if(_.length=0,this._rotated){Ht[0].u=t.x/n,Ht[1].u=(t.x+u)/n,Ht[2].u=(t.x+u+c)/n,Ht[3].u=(t.x+t.height)/n,Ht[3].v=t.y/r,Ht[2].v=(t.y+s)/r,Ht[1].v=(t.y+s+o)/r,Ht[0].v=(t.y+t.width)/r;for(var l=0;l<4;++l)for(var f=Ht[l],d=0;d<4;++d){var p=Ht[3-d];_.push({u:f.u,v:p.v})}}else{Ht[0].u=t.x/n,Ht[1].u=(t.x+s)/n,Ht[2].u=(t.x+s+o)/n,Ht[3].u=(t.x+t.width)/n,Ht[3].v=t.y/r,Ht[2].v=(t.y+h)/r,Ht[1].v=(t.y+h+c)/r,Ht[0].v=(t.y+t.height)/r;for(var v=0;v<4;++v)for(var y=Ht[v],m=0;m<4;++m){var g=Ht[m];_.push({u:g.u,v:y.v})}}this.emit(i.EVENT_UV_UPDATED,this)},n._calculateUV=function(){var t=this._rect,e=this.uv,i=this.unbiasUV,n=this.texture,r=n.width,s=n.height;if(this._rotated){var a=0===r?0:t.x/r,o=0===r?1:(t.x+t.height)/r,h=0===s?0:t.y/s,u=0===s?1:(t.y+t.width)/s;this._isFlipUVX&&this._isFlipUVY?(e[0]=o,e[1]=u,e[2]=o,e[3]=h,e[4]=a,e[5]=u,e[6]=a,e[7]=h):this._isFlipUVX?(e[0]=o,e[1]=h,e[2]=o,e[3]=u,e[4]=a,e[5]=h,e[6]=a,e[7]=u):this._isFlipUVY?(e[0]=a,e[1]=u,e[2]=a,e[3]=h,e[4]=o,e[5]=u,e[6]=o,e[7]=h):(e[0]=a,e[1]=h,e[2]=a,e[3]=u,e[4]=o,e[5]=h,e[6]=o,e[7]=u);var c=0===r?0:t.x/r,_=0===r?1:(t.x+t.height)/r,l=0===s?0:t.y/s,f=0===s?1:(t.y+t.width)/s;this._isFlipUVX&&this._isFlipUVY?(i[0]=_,i[1]=f,i[2]=_,i[3]=l,i[4]=c,i[5]=f,i[6]=c,i[7]=l):this._isFlipUVX?(i[0]=_,i[1]=l,i[2]=_,i[3]=f,i[4]=c,i[5]=l,i[6]=c,i[7]=f):this._isFlipUVY?(i[0]=c,i[1]=f,i[2]=c,i[3]=l,i[4]=_,i[5]=f,i[6]=_,i[7]=l):(i[0]=c,i[1]=l,i[2]=c,i[3]=f,i[4]=_,i[5]=l,i[6]=_,i[7]=f)}else{var d=0===r?0:t.x/r,p=0===r?1:(t.x+t.width)/r,v=0===s?1:(t.y+t.height)/s,y=0===s?0:t.y/s;this._isFlipUVX&&this._isFlipUVY?(e[0]=p,e[1]=y,e[2]=d,e[3]=y,e[4]=p,e[5]=v,e[6]=d,e[7]=v):this._isFlipUVX?(e[0]=p,e[1]=v,e[2]=d,e[3]=v,e[4]=p,e[5]=y,e[6]=d,e[7]=y):this._isFlipUVY?(e[0]=d,e[1]=y,e[2]=p,e[3]=y,e[4]=d,e[5]=v,e[6]=p,e[7]=v):(e[0]=d,e[1]=v,e[2]=p,e[3]=v,e[4]=d,e[5]=y,e[6]=p,e[7]=y);var m=0===r?0:t.x/r,g=0===r?1:(t.x+t.width)/r,x=0===s?1:(t.y+t.height)/s,S=0===s?0:t.y/s;this._isFlipUVX&&this._isFlipUVY?(i[0]=g,i[1]=S,i[2]=m,i[3]=S,i[4]=g,i[5]=x,i[6]=m,i[7]=x):this._isFlipUVX?(i[0]=g,i[1]=x,i[2]=m,i[3]=x,i[4]=g,i[5]=S,i[6]=m,i[7]=S):this._isFlipUVY?(i[0]=m,i[1]=S,i[2]=g,i[3]=S,i[4]=m,i[5]=x,i[6]=g,i[7]=x):(i[0]=m,i[1]=x,i[2]=g,i[3]=x,i[4]=m,i[5]=S,i[6]=g,i[7]=S)}this._calculateSlicedUV()},n._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},n._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},n._checkPackable=function(){var t=Lt;if(t){var e=this._texture;if(e instanceof et&&!e.isCompressed){var i=this.width,n=this.height;if(!e.image||i>t.maxFrameSize||n>t.maxFrameSize)this._packable=!1;else{var r=p.HTMLCanvasElement;e.image&&e.image instanceof r&&(this._packable=!0)}}else this._packable=!1}},n._serialize=function(){return null},n._deserialize=function(t){var e=t,i=e.rect;i&&(this._rect=new c(i.x,i.y,i.width,i.height));var n=e.offset;e.offset&&(this._offset=new l(n.x,n.y));var r=e.originalSize;e.originalSize&&(this._originalSize=new f(r.width,r.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable,this._pixelsToUnit=e.pixelsToUnit;var s=e.pivot;s&&(this._pivot=new l(s.x,s.y)),this._meshType=e.meshType;var a=e.capInsets;a&&(this._capInsets[0]=a[0],this._capInsets[1]=a[1],this._capInsets[2]=a[2],this._capInsets[3]=a[3]);var h=e.vertices;if(h){this.vertices||(this.vertices={rawPosition:[],positions:[],indexes:h.indexes,uv:h.uv,nuv:h.nuv,minPos:new o(h.minPos.x,h.minPos.y,h.minPos.z),maxPos:new o(h.maxPos.x,h.maxPos.y,h.maxPos.z)}),this.vertices.rawPosition.length=0;for(var u=h.rawPosition,_=0;_<u.length;_+=3)this.vertices.rawPosition.push(new o(u[_],u[_+1],u[_+2]));this._updateMeshVertices()}},n.clone=function(){var t,e,n,r,s,a=new i,o=this.vertices;return a.vertices=o?{rawPosition:o.rawPosition.slice(0),positions:o.positions.slice(0),indexes:o.indexes.slice(0),uv:o.uv.slice(0),nuv:o.nuv.slice(0),minPos:o.minPos.clone(),maxPos:o.maxPos.clone()}:null,(t=a.uv).splice.apply(t,[0,a.uv.length].concat(this.uv)),(e=a.unbiasUV).splice.apply(e,[0,a.unbiasUV.length].concat(this.unbiasUV)),(n=a.uvSliced).splice.apply(n,[0,a.uvSliced.length].concat(this.uvSliced)),a._rect.set(this._rect),a._trimmedBorder.set(this._trimmedBorder),a._offset.set(this._offset),a._originalSize.set(this._originalSize),a._rotated=this._rotated,(r=a._capInsets).splice.apply(r,[0,a._capInsets.length].concat(this._capInsets)),a._atlasUuid=this._atlasUuid,a._texture=this._texture,a._isFlipUVX=this._isFlipUVX,a._isFlipUVY=this._isFlipUVY,this._original?a._original={_texture:this._original._texture,_x:this._original._x,_y:this._original._y}:a._original=null,a._packable=this._packable,a._pixelsToUnit=this._pixelsToUnit,a._pivot.set(this._pivot),a._meshType=this._meshType,a._extrude=this._extrude,(s=a._customOutLine).splice.apply(s,[0,a._customOutLine.length].concat(this._customOutLine)),a._minPos=this._minPos,a._maxPos=this._maxPos,this._mesh&&a._createMesh(),a},n._refreshTexture=function(t){this._texture=t;var e=this._texture,i={},n=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(e)||(i.rect=new c(0,0,e.width,e.height),n=!0),(0===this._originalSize.width||0===this._originalSize.height||n)&&(i.originalSize=new f(e.width,e.height),n=!0),n&&this.reset(i),this._checkPackable(),this._mesh&&this._updateMesh()},n.onLoaded=function(){this._calcTrimmedBorder()},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var i=new et;i.initDefault(),this._refreshTexture(i),this._calculateUV()},n.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},n._initVertices=function(){if(this.vertices?(this.vertices.rawPosition.length=0,this.vertices.positions.length=0,this.vertices.indexes.length=0,this.vertices.uv.length=0,this.vertices.nuv.length=0,this.vertices.minPos.set(0,0,0),this.vertices.maxPos.set(0,0,0)):this.vertices={rawPosition:[],positions:[],indexes:[],uv:[],nuv:[],minPos:new o,maxPos:new o},this._meshType===zt.POLYGON);else{var t=this.texture,e=t.width,i=t.height,n=this.rect,r=n.width,s=n.height,a=n.x,h=i-n.y-s,u=r/2,c=s/2,_=0===e?0:a/e,l=0===e?1:(a+r)/e,f=0===i?1:(h+s)/i,d=0===i?0:n.y/i;Ut.set(-u,-c,0),this.vertices.rawPosition.push(Ut.clone()),this.vertices.uv.push(a),this.vertices.uv.push(h+s),this.vertices.nuv.push(_),this.vertices.nuv.push(d),this.vertices.minPos.set(Ut),Ut.set(u,-c,0),this.vertices.rawPosition.push(Ut.clone()),this.vertices.uv.push(a+r),this.vertices.uv.push(h+s),this.vertices.nuv.push(l),this.vertices.nuv.push(d),Ut.set(-u,c,0),this.vertices.rawPosition.push(Ut.clone()),this.vertices.uv.push(a),this.vertices.uv.push(h),this.vertices.nuv.push(_),this.vertices.nuv.push(f),Ut.set(u,c,0),this.vertices.rawPosition.push(Ut.clone()),this.vertices.uv.push(a+r),this.vertices.uv.push(h),this.vertices.nuv.push(l),this.vertices.nuv.push(f),this.vertices.maxPos.set(Ut),this.vertices.indexes.push(0),this.vertices.indexes.push(1),this.vertices.indexes.push(2),this.vertices.indexes.push(2),this.vertices.indexes.push(1),this.vertices.indexes.push(3)}this._updateMeshVertices()},n._updateMeshVertices=function(){Vt.identity();var t=1/this._pixelsToUnit,e=-(this._pivot.x-.5)*this.rect.width*t,i=-(this._pivot.y-.5)*this.rect.height*t,n=new o(e,i,0);Vt.transform(n),n.set(t,t,1),Vt.scale(n);for(var r=this.vertices,s=0;s<r.rawPosition.length;s++){var a=r.rawPosition[s];o.transformMat4(n,a,Vt),o.toArray(r.positions,n,3*s)}o.transformMat4(this._minPos,r.minPos,Vt),o.transformMat4(this._maxPos,r.maxPos,Vt)},n._createMesh=function(){this._mesh=Pt({primitiveMode:ft.TRIANGLE_LIST,positions:this.vertices.positions,uvs:this.vertices.nuv,indices:this.vertices.indexes,minPos:this._minPos,maxPos:this._maxPos,attributes:[new dt(pt.ATTR_POSITION,vt.RGB32F),new dt(pt.ATTR_TEX_COORD,vt.RG32F)]})},n._updateMesh=function(){this._mesh&&this._mesh.destroy(),this._initVertices(),this._createMesh()},s(i,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV(),this._calcTrimmedBorder())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV(),this._calcTrimmedBorder())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this._calcTrimmedBorder()}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?t!==this._texture&&this.reset({texture:t},!0):v(3122,this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){globalThis.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}},{key:"pixelsToUnit",get:function(){return this._pixelsToUnit}},{key:"pivot",get:function(){return this._pivot}},{key:"mesh",get:function(){return this._mesh}},{key:"trimmedBorder",get:function(){return this._trimmedBorder}}]),i}(Z)).EVENT_UV_UPDATED="uv_updated",Nt.MeshType=zt,Mt=Nt))||Mt);i.SpriteFrame=Gt;var Xt,Wt=t("m",[new dt(pt.ATTR_POSITION,vt.RGB32F)]),Yt=t("n",[new dt(pt.ATTR_POSITION,vt.RGB32F),new dt(pt.ATTR_COLOR,vt.RGBA32F)]),jt=t("i",[new dt(pt.ATTR_POSITION,vt.RGB32F),new dt(pt.ATTR_TEX_COORD,vt.RG32F),new dt(pt.ATTR_COLOR,vt.RGBA32F)]),qt=t("u",[new dt(pt.ATTR_POSITION,vt.RGB32F),new dt(pt.ATTR_TEX_COORD,vt.RG32F),new dt(pt.ATTR_COLOR,vt.RGBA8,!0)]),Kt=[new dt(pt.ATTR_POSITION,vt.RGB32F),new dt(pt.ATTR_TEX_COORD,vt.RG32F),new dt(pt.ATTR_COLOR,vt.RGBA32F),new dt(pt.ATTR_COLOR2,vt.RGBA32F)],Qt=t("w",[new dt(pt.ATTR_POSITION,vt.RGB32F),new dt(pt.ATTR_TEX_COORD,vt.RG32F),new dt(pt.ATTR_COLOR,vt.RGBA8,!0),new dt(pt.ATTR_COLOR2,vt.RGBA8,!0)]);function Zt(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=yt[n.format].count}return e}function Jt(t){for(var e=0,i=0;i<t.length;i++){var n=t[i];e+=yt[n.format].size}return e}i.internal.vfmtPosUvColor=jt,i.internal.vfmtPosUvTwoColor=Kt,i.internal.vfmtPosUvColor4B=qt,i.internal.vfmtPosUvTwoColor4B=Qt,t("v",Object.freeze({__proto__:null,vfmt:Wt,vfmtPosColor:Yt,vfmtPosUvColor:jt,vfmtPosUvColor4B:qt,vfmtPosUvTwoColor:Kt,vfmtPosUvTwoColor4B:Qt,getComponentPerVertex:Zt,getAttributeStride:Jt})),function(t){t[t.byteOffset=0]="byteOffset",t[t.vertexOffset=1]="vertexOffset",t[t.indexOffset=2]="indexOffset",t[t.dirty=3]="dirty",t[t.count=4]="count"}(Xt||(Xt={}));var $t,te,ee,ie,ne,re,se=t("M",function(){var t=e.prototype;function e(){this._byteOffset=0,this._vertexOffset=0,this._indexOffset=0,this._dirty=!1,this._floatsPerVertex=0,this._vData=null,this._iData=null,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0,this.initSharedBuffer(),this.syncSharedBufferToNative()}return t.initSharedBuffer=function(){},t.syncSharedBufferToNative=function(){},t.initialize=function(t,e,i,n){this._initVDataCount=i,this._initIDataCount=n,this._attributes=e,this.floatsPerVertex=Jt(e)>>2,y(this._initVDataCount/this._floatsPerVertex<65536,m(9005)),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(t))},t.reset=function(){this._nextFreeIAHandle=0,this.dirty=!1},t.destroy=function(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(var t=0;t<this._iaPool.length;++t){var e=this._iaPool[t];e.vertexBuffers[0]&&e.vertexBuffers[0].destroy(),e.indexBuffer&&e.indexBuffer.destroy(),e.ia.destroy()}this._iaPool.length=0},t.setDirty=function(){this.dirty=!0},t.request=function(){return v(9002),!1},t.requireFreeIA=function(t){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(t)),this._iaPool[this._nextFreeIAHandle++].ia},t.recycleIA=function(t){for(var e=this._iaPool,i=0;i<this._nextFreeIAHandle;++i)if(t===e[i].ia){var n=e[i];return e[i]=e[--this._nextFreeIAHandle],void(e[this._nextFreeIAHandle]=n)}},t.checkCapacity=function(t,e){var i=(this.vertexOffset+t)*this._floatsPerVertex,n=this.indexOffset+e;return!(i>this._initVDataCount||n>this._initIDataCount)},t.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=g.__isWebIOS14OrIPadOS14Env,e=t?this._nextFreeIAHandle:1;if(t&&e/this._iaPool.length<.5){for(var i=e/.5,n=this._iaPool.length-1;n>=i;n--){var r=this._iaPool[n];r.vertexBuffers[0]&&r.vertexBuffers[0].destroy(),r.indexBuffer&&r.indexBuffer.destroy(),r.ia.destroy()}this._iaPool.length=i}for(var s=this.byteOffset,a=this.indexOffset,o=0;o<e;++o){var h=this._iaPool[o],u=new Float32Array(this.vData.buffer,0,s>>2),c=new Uint16Array(this.iData.buffer,0,a),_=h.vertexBuffers[0];s>_.size&&_.resize(s),_.update(u),2*a>h.indexBuffer.size&&h.indexBuffer.resize(2*a),h.indexBuffer.update(c)}this.dirty=!1}},t.createNewIA=function(t){var e,i,n;if(g.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){var r=this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT,s=Uint16Array.BYTES_PER_ELEMENT,a=t.createBuffer(new mt(gt.VERTEX|gt.TRANSFER_DST,xt.HOST|xt.DEVICE,r,r));n=t.createBuffer(new mt(gt.INDEX|gt.TRANSFER_DST,xt.HOST|xt.DEVICE,s,s)),i=[a],this._iaInfo=new St(this._attributes,i,n),e=t.createInputAssembler(this._iaInfo)}else e=t.createInputAssembler(this._iaInfo),i=this._iaInfo.vertexBuffers,n=this._iaInfo.indexBuffer;return{ia:e,vertexBuffers:i,indexBuffer:n}},s(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"byteOffset",get:function(){return this._byteOffset},set:function(t){this._byteOffset=t}},{key:"vertexOffset",get:function(){return this._vertexOffset},set:function(t){this._vertexOffset=t}},{key:"indexOffset",get:function(){return this._indexOffset},set:function(t){this._indexOffset=t}},{key:"dirty",get:function(){return this._dirty},set:function(t){this._dirty=t}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex},set:function(t){this._floatsPerVertex=t}},{key:"vData",get:function(){return this._vData},set:function(t){this._vData=t}},{key:"iData",get:function(){return this._iData},set:function(t){this._iData=t}},{key:"nativeObj",get:function(){return this._nativeObj}},{key:"sharedBuffer",get:function(){return this._sharedBuffer}}]),e}()),ae=function(){function t(t,e){this._device=null,this._attributes=null,this._vertexFormatBytes=void 0,this._floatsPerVertex=void 0,this._buffers=[],this._device=t,this._attributes=e,this._floatsPerVertex=Jt(e)>>2,this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT}var e=t.prototype;return e.initialize=function(){},e.reset=function(){},e.request=function(){},e.appendBuffers=function(){},e.uploadBuffers=function(){},e.destroy=function(){this._attributes.length=0},s(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}(),oe=new x((function(){return{offset:0,length:0}}),32),he=function(){function t(t,e,i,n,r,s){this._ib=void 0,this.vertexAccessor=t,this.bufferId=e,this.meshBuffer=i,this.vertexOffset=n,this.vb=r,this.indexCount=s,this._ib=new Uint16Array(s),y(i===t.getMeshBuffer(e))}return t.prototype.setIndexBuffer=function(){},s(t,[{key:"ib",get:function(){return this._ib}}]),t}(),ue=t("k",function(t){function i(e,r,s,a){var o;return(o=t.call(this,e,r)||this)._freeLists=[],o._vCount=0,o._iCount=0,o._id=0,o._vCount=s||Math.floor(1024*n.BATCHER2D_MEM_INCREMENT/o._vertexFormatBytes),o._iCount=a||o._vCount*i.IB_SCALE,o._id=i.generateID(),o._allocateBuffer(),o}e(i,t);var r=i.prototype;return r.destroy=function(){for(var e=0;e<this._buffers.length;++e){this._buffers[e].destroy();for(var i=this._freeLists[e],n=0;n<i.length;++n)oe.free(i[n])}this._buffers.length=0,this._freeLists.length=0,t.prototype.destroy.call(this)},r.reset=function(){for(var t=0;t<this._buffers.length;++t){var e=this._buffers[t];e.indexOffset=0,e.reset()}},r.getVertexBuffer=function(t){return this._buffers[t].vData},r.getIndexBuffer=function(t){return this._buffers[t].iData},r.getMeshBuffer=function(t){return this._buffers[t]},r.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var e=this._freeLists[t][0],i=this._buffers[t];(!e||e.length<i.vData.byteLength)&&i.uploadBuffers()}},r.appendIndices=function(t,e){var i=this._buffers[t];if(e.length){var n=i.indexOffset+e.length;if(i.iData.length<n){var r=Math.floor(1.25*n),s=new Uint16Array(r);s.set(i.iData),i.iData=s}i.iData.set(e,i.indexOffset),i.indexOffset+=e.length}},r.allocateChunk=function(t,e){var i=t*this.vertexFormatBytes;if(t>this._vCount||e>this._iCount)return d(9004,i),null;for(var n,r=null,s=0,a=-1,o=null,h=0;h<this._buffers.length;++h){r=this._buffers[h],n=this._freeLists[h];for(var u=0;u<n.length;++u)if(n[u].length>=i){o=n[u],s=h,a=u;break}if(o)break}if(o||(s=this._allocateBuffer(),(r=this._buffers[s])&&(a=0,o=this._freeLists[s][a])),o){var c=o.offset/this.vertexFormatBytes,_=new Float32Array(r.vData.buffer,o.offset,i>>2).fill(0);return this._allocateChunkFromEntry(s,a,o,i),new he(this,s,r,c,_,e)}return null},r.recycleChunk=function(t){var e=this._freeLists[t.bufferId],i=this._buffers[t.bufferId],n=t.vertexOffset*this.vertexFormatBytes,r=t.vb.byteLength;if(0!==r){for(var s=!1,a=0,o=null,h=e[a];h&&h.offset<n;)o=h,h=e[++a];if(o&&0==n-(o.offset+o.length)&&(o.length+=r,n=o.offset,r=o.length,h&&h.offset-(n+r)==0&&(o.length+=h.length,e.splice(a,1),oe.free(h),h=null),s=!0),!s&&h){if(0==h.offset-(n+r))h.offset=n,h.length+=r;else{var u=oe.alloc();u.offset=n,u.length=r,e.splice(a,0,u)}s=!0}if(s)n+r===i.byteOffset&&(i.byteOffset=n);else{var c=oe.alloc();c.offset=n,c.length=r,e.push(c)}}},r._allocateChunkFromEntry=function(t,e,i,n){var r=i.length-n,s=i.offset+n,a=this._buffers[t];a.byteOffset<s&&(a.byteOffset=s),S(r>=0,9004,t,i.offset,i.length),0===r?(this._freeLists[t].splice(e,1),oe.free(i)):(i.offset+=n,i.length=r)},r._allocateBuffer=function(){S(this._buffers.length===this._freeLists.length,9003);var t=new se,e=this._vCount*this._floatsPerVertex;t.initialize(this._device,this._attributes,e,this._iCount),this._buffers.push(t);var i=oe.alloc();i.offset=0,i.length=t.vData.byteLength;var n=[i];return this._freeLists.push(n),nt.root.batcher2D.syncMeshBuffersToNative(this.id,this._buffers),this._buffers.length-1},i.generateID=function(){return i.ID_COUNT++},s(i,[{key:"id",get:function(){return this._id}}]),i}(ae));ue.IB_SCALE=4,ue.ID_COUNT=0,function(t){t[t.DrawInfoType=0]="DrawInfoType",t[t.VertDirty=1]="VertDirty",t[t.IsMeshBuffer=2]="IsMeshBuffer",t[t.Stride=3]="Stride",t[t.Count=4]="Count"}($t||($t={})),function(t){t[t.BufferID=0]="BufferID",t[t.AccessorID=1]="AccessorID",t[t.Count=2]="Count"}(te||(te={})),function(t){t[t.VertexOffset=0]="VertexOffset",t[t.IndexOffset=1]="IndexOffset",t[t.VBCount=2]="VBCount",t[t.IBCount=3]="IBCount",t[t.DataHash=4]="DataHash",t[t.Count=5]="Count"}(ee||(ee={})),t("t",ie),function(t){t[t.COMP=0]="COMP",t[t.MODEL=1]="MODEL",t[t.MIDDLEWARE=2]="MIDDLEWARE",t[t.SUB_NODE=3]="SUB_NODE"}(ie||t("t",ie={})),t("s",function(){function t(t){this._accId=-1,this._bufferId=-1,this._vertexOffset=0,this._indexOffset=0,this._vb=null,this._ib=null,this._vData=null,this._iData=null,this._vertDirty=!1,this._vbCount=0,this._ibCount=0,this._dataHash=0,this._isMeshBuffer=!1,this._material=null,this._texture=null,this._sampler=null,this._stride=0,this._useLocal=!1,this._model=null,this._drawInfoType=ie.COMP,this._subNode=null,this._uint8SharedBuffer=void 0,this._uint16SharedBuffer=void 0,this._uint32SharedBuffer=void 0,this.init(t);var e=this._nativeObj.getAttrSharedBufferForJS(),i=0;this._uint8SharedBuffer=new Uint8Array(e,i,$t.Count),i+=$t.Count*Uint8Array.BYTES_PER_ELEMENT,this._uint16SharedBuffer=new Uint16Array(e,i,te.Count),i+=te.Count*Uint16Array.BYTES_PER_ELEMENT,this._uint32SharedBuffer=new Uint32Array(e,i,ee.Count)}var e=t.prototype;return e.init=function(){},e.clear=function(){this._bufferId=0,this._vertexOffset=0,this._indexOffset=0,this._vertDirty=!1},e.setAccId=function(t){this._accId=t},e.setBufferId=function(t){this._bufferId=t},e.setAccAndBuffer=function(t,e){this._bufferId=e,this._accId=t},e.setVertexOffset=function(t){this._vertexOffset=t},e.setIndexOffset=function(t){this._indexOffset=t},e.setVB=function(){},e.setIB=function(){},e.setVData=function(){},e.setIData=function(){},e.setVBCount=function(t){this._vbCount=t},e.setIBCount=function(){},e.setVertDirty=function(t){this._vertDirty=t},e.setDataHash=function(t){this._dataHash=t},e.setIsMeshBuffer=function(t){this._isMeshBuffer=t},e.setMaterial=function(t){this._material=t},e.setTexture=function(t){this._texture=t},e.setSampler=function(t){this._sampler=t},e.setModel=function(){},e.setDrawInfoType=function(t){this._drawInfoType=t},e.setSubNode=function(t){this._subNode=t},e.setStride=function(t){this._stride=t},e.initRender2dBuffer=function(){},e.fillRender2dBuffer=function(){},s(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"render2dBuffer",get:function(){return this._render2dBuffer}}]),t}()),t("l",ne),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(ne||t("l",ne={})),function(t){t[t.stencilTest=0]="stencilTest",t[t.func=1]="func",t[t.stencilMask=2]="stencilMask",t[t.writeMask=3]="writeMask",t[t.failOp=4]="failOp",t[t.zFailOp=5]="zFailOp",t[t.passOp=6]="passOp",t[t.ref=7]="ref",t[t.count=8]="count"}(re||(re={}));var ce,_e,le,fe,de,pe=t("S",function(){function t(){this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Dt.ALWAYS,stencilMask:65535,writeMask:65535,failOp:wt.KEEP,zFailOp:wt.KEEP,passOp:wt.KEEP,ref:1},this._stage=ne.DISABLED,this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){return t.stencilStage!==ne.ENTER_LEVEL?ne.CLEAR_INVERTED:ne.CLEAR},e.enableMask=function(){this.stage=ne.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=ne.DISABLED:this.stage=ne.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.getMaskStackSize=function(){return this._maskStack.length},e.reset=function(){this._maskStack.length=0,this.stage=ne.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var i=0,n=!1,r=!1,s=Dt.LESS,a=this.stencilStateMap;if(e&&e.passes[0]){var o=e.passes[0].depthStencilState,h=0,u=0;o.depthTest&&(h=1),o.depthWrite&&(u=1),i=h|u<<1|o.depthFunc<<2|t<<6|this._maskStack.length<<9,n=o.depthTest,r=o.depthWrite,s=o.depthFunc,a=this.stencilStateMapWithDepth}else i=t<<16|this._maskStack.length;if(a&&a.has(i))return a.get(i);this.setStateFromStage(t);var c=new Et(n,r,s,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return a.set(i,c),c},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===ne.DISABLED?(e.stencilTest=!1,e.func=Dt.ALWAYS,e.failOp=wt.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===ne.ENABLED?(e.func=Dt.EQUAL,e.failOp=wt.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===ne.CLEAR?(e.func=Dt.NEVER,e.failOp=wt.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===ne.CLEAR_INVERTED||t===ne.ENTER_LEVEL?(e.func=Dt.NEVER,e.failOp=wt.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===ne.ENTER_LEVEL_INVERTED&&(e.func=Dt.NEVER,e.failOp=wt.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},s(t,[{key:"stage",get:function(){return this._stage},set:function(t){this._stage=t}},{key:"pattern",get:function(){return this._stencilPattern}}]),t}());pe.sharedManager=null,pe.sharedManager=new pe,t("q",ce),function(t){t[t.STATIC=0]="STATIC",t[t.DYNAMIC=1]="DYNAMIC",t[t.CROSSED=2]="CROSSED"}(ce||t("q",ce={})),function(t){t[t.localOpacity=0]="localOpacity",t[t.count=1]="count"}(_e||(_e={})),function(t){t[t.colorR=0]="colorR",t[t.colorG=1]="colorG",t[t.colorB=2]="colorB",t[t.colorA=3]="colorA",t[t.maskMode=4]="maskMode",t[t.count=5]="count"}(le||(le={})),function(t){t[t.colorDirty=0]="colorDirty",t[t.enabled=1]="enabled",t[t.useLocal=2]="useLocal",t[t.count=3]="count"}(fe||(fe={})),function(t){t[t.NONE=0]="NONE",t[t.MASK=1]="MASK",t[t.MASK_INVERTED=2]="MASK_INVERTED",t[t.MASK_NODE=3]="MASK_NODE",t[t.MASK_NODE_INVERTED=4]="MASK_NODE_INVERTED"}(de||(de={}));var ve,ye,me,ge,xe,Se,De,Ee,we,Re,Ae,Ce,Te,Ie,be,Pe,Fe,Oe,Be=t("p",function(){function t(){this._renderEntityType=ce.STATIC,this._dynamicDrawInfoArr=[],this._node=null,this._renderTransform=null,this._stencilStage=ne.DISABLED,this._useLocal=!1,this._maskMode=de.NONE,this._color=D.WHITE,this._localOpacity=255,this._colorDirty=!0,this._enabled=!1}var e=t.prototype;return e.addDynamicRenderDrawInfo=function(){},e.removeDynamicRenderDrawInfo=function(){},e.clearDynamicRenderDrawInfos=function(){},e.clearStaticRenderDrawInfos=function(){},e.setDynamicRenderDrawInfo=function(){},e.setMaskMode=function(t){this._maskMode=t},e.getStaticRenderDrawInfo=function(){return null},e.setNode=function(t){this._node=t},e.setRenderTransform=function(t){this._renderTransform=t},e.setStencilStage=function(t){this._stencilStage=t},e.setUseLocal=function(t){this._useLocal=t},e.initSharedBuffer=function(){},s(t,[{key:"nativeObj",get:function(){return this._nativeObj}},{key:"renderDrawInfoArr",get:function(){return this._dynamicDrawInfoArr}},{key:"renderEntityType",get:function(){return this._renderEntityType}},{key:"color",get:function(){return this._color},set:function(t){this._color=t}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(t){this._localOpacity=t}},{key:"colorDirty",get:function(){return this._colorDirty},set:function(t){this._colorDirty=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}}]),t}()),ke=Jt(jt)>>2,Me=t("B",function(){function t(t){void 0===t&&(t=jt),this.chunk=null,this._renderDrawInfo=null,this._material=null,this._dataHash=0,this._isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=jt,this._drawInfoType=ie.COMP,this._multiOwner=!1,this._batcher=null,this._floatStride=t===jt?ke:Jt(t)>>2,this._vertexFormat=t}var e=t.prototype;return e.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},e.initRenderDrawInfo=function(t,e){void 0===e&&(e=ie.COMP)},e.removeRenderDrawInfo=function(){},e.setRenderDrawInfoAttributes=function(){},s(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}},{key:"drawInfoType",get:function(){return this._drawInfoType},set:function(t){this._drawInfoType=t,this._renderDrawInfo&&this._renderDrawInfo.setDrawInfoType(t)}},{key:"renderDrawInfo",get:function(){return this._renderDrawInfo}},{key:"material",get:function(){return this._material},set:function(t){this._material=t,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(t)}},{key:"dataHash",get:function(){return this._dataHash},set:function(t){this._dataHash=t,this._renderDrawInfo&&this._renderDrawInfo.setDataHash(t)}},{key:"multiOwner",get:function(){return this._multiOwner},set:function(t){this._multiOwner=t}},{key:"batcher",get:function(){return this._batcher||(this._batcher=nt.root.batcher2D),this._batcher}}]),t}()),Ne=t("e",function(t){function i(e,i){var n;return void 0===e&&(e=jt),(n=t.call(this,e)||this)._vertDirty=!0,n._textureHash=0,n.indices=null,n.layer=0,n.nodeDirty=!0,n.passDirty=!0,n.textureDirty=!0,n.hashDirty=!0,n._data=[],n._frame=null,n._accessor=null,n.vertexRow=1,n.vertexCol=1,i||(i=n.batcher.switchBufferAccessor(n._vertexFormat)),n._accessor=i,n}e(i,t),i.add=function(t,e){void 0===t&&(t=jt);var n=new i(t,e);return e||(e=nt.root.batcher2D.switchBufferAccessor(n._vertexFormat)),n._accessor=e,n},i.remove=function(t){t.clear(),t._accessor=null};var n=i.prototype;return n.resize=function(t,e){t===this._vc&&e===this._ic&&this.chunk||(this._vc=t,this._ic=e,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,e),this.updateHash())},n.setRenderDrawInfoAttributes=function(){},n.fillDrawInfoAttributes=function(){},n.syncRender2dBuffer=function(){},n.resizeAndCopy=function(t,e){if(t!==this._vc||e!==this._ic||!this.chunk){this._vc=t,this._ic=e;var i=this.chunk;this.chunk=this._accessor.allocateChunk(t,e),i&&(this.chunk.vb.set(i.vb),this._accessor.recycleChunk(i)),this.updateHash()}},n.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},n.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},n.updatePass=function(t){this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0},n.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},n.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.textureHash;this.dataHash=Rt(t,666),this.hashDirty=!1},n.updateRenderData=function(t,e){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.passDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&this._renderDrawInfo.setMaterial(this.material)),this.nodeDirty){var i=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==i&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=e,this.textureHash=e.getHash(),this.textureDirty=!1,this.hashDirty=!0,this._renderDrawInfo&&(this._renderDrawInfo.setTexture(this.frame?this.frame.getGFXTexture():null),this._renderDrawInfo.setSampler(this.frame?this.frame.getGFXSampler():null))),this.hashDirty&&(this.updateHash(),this._renderDrawInfo&&this._renderDrawInfo.setDataHash(this.dataHash))},n.clear=function(){this.resize(0,0),this._data.length=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.frame=null,this.textureHash=0,this.dataHash=0},i.createStaticVBAccessor=function(t,e,i){var n=nt.root.device;return new ue(n,t,e,i)},s(i,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){for(var i=e.length;i<t;i++)e.push({x:0,y:0,z:0,u:0,v:0,color:D.WHITE.clone()});e.length=t}this.syncRender2dBuffer()}},{key:"data",get:function(){return this._data}},{key:"vertDirty",get:function(){return this._vertDirty},set:function(t){this._vertDirty=t,this._renderDrawInfo&&t&&this._renderDrawInfo.setVertDirty(t)}},{key:"textureHash",get:function(){return this._textureHash},set:function(t){this._textureHash=t}},{key:"frame",get:function(){return this._frame},set:function(t){this._frame=t,this._renderDrawInfo&&(this._frame?(this._renderDrawInfo.setTexture(this._frame.getGFXTexture()),this._renderDrawInfo.setSampler(this._frame.getGFXSampler())):(this._renderDrawInfo.setTexture(null),this._renderDrawInfo.setSampler(null)))}},{key:"accessor",get:function(){return this._accessor}}]),i}(Me)),Le=(t("f",function(t){function i(e){var i;return void 0===e&&(e=jt),(i=t.call(this,e)||this)._isMeshBuffer=!0,i.vData=void 0,i.iData=void 0,i.vertexStart=0,i.vertexRange=0,i.indexStart=0,i.indexRange=0,i.lastFilledIndex=0,i.lastFilledVertex=0,i.frame=void 0,i._byteLength=0,i._vertexBuffers=[],i._indexBuffer=null,i._iaPool=null,i._iaInfo=null,i.vData=new Float32Array(256*i.stride),i.iData=new Uint16Array(1536),i}e(i,t),i.add=function(t){void 0===t&&(t=jt);var e=new i;return e._floatStride=t===jt?ke:Jt(t)>>2,e._vertexFormat=t,e},i.remove=function(t){t.clear()};var n=i.prototype;return n.request=function(t,e){var i=this._byteLength+t*this.stride;return!!this.reserve(t,e)&&(this._vc+=t,this._ic+=e,this._byteLength=i,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,e){var i=this._byteLength+t*this.stride,n=this.indexCount+e;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,s=this.iData.length,a=this.vData.length,o=this.iData.length;if(i>r||n>s){for(;r<i||s<n;)r=4*(a*=2),s=o*=2;this._reallocBuffer(a,o)}return!0},n.resize=function(t,e){var i=t*this.stride;y(t>=0&&e>=0&&i<=this.vData.byteLength&&e<=this.iData.length),this._vc=t,this._ic=e,this._byteLength=i,this.updateRange(0,t,0,e)},n.updateRange=function(t,e,i,n){y(e>=0&&n>=0&&e<=this._vc&&n<=this._ic),this.vertexStart=t,this.indexStart=i,this.vertexRange=e,this.indexRange=n},n.requestIA=function(t){this._initIAInfo(t);var e=this._iaPool.add();return e.firstIndex=this.indexStart,e.indexCount=this.indexRange,e},n.uploadBuffers=function(){if(0!==this._byteLength&&this._vertexBuffers[0]&&this._indexBuffer){var t=this._ic,e=new Float32Array(this.vData.buffer,0,this._byteLength>>2),i=new Uint16Array(this.iData.buffer,0,t),n=this._vertexBuffers[0];this._byteLength>n.size&&n.resize(this._byteLength),n.update(e);var r=t<<1;r>this._indexBuffer.size&&this._indexBuffer.resize(r),this._indexBuffer.update(i)}},n.freeIAPool=function(){this._iaPool&&this._iaPool.reset()},n.reset=function(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var e=this;if(!this._iaInfo){var i=this.stride,n=this._vertexBuffers;n.length||n.push(t.createBuffer(new mt(gt.VERTEX|gt.TRANSFER_DST,xt.DEVICE,i,i)));var r=Uint16Array.BYTES_PER_ELEMENT;this._indexBuffer||(this._indexBuffer=t.createBuffer(new mt(gt.INDEX|gt.TRANSFER_DST,xt.DEVICE,r,r))),this._iaInfo=new St(this._vertexFormat,n,this._indexBuffer),this._iaPool=new E((function(){return t.createInputAssembler(e._iaInfo)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,e){var i=this.vData;this.vData=new Float32Array(t),i&&this.vData.set(i,0);var n=this.iData;this.iData=new Uint16Array(e),n&&this.iData.set(n,0)},n.setRenderDrawInfoAttributes=function(){},n.particleInitRenderDrawInfo=function(){},s(i,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this._byteLength>>>2}}]),i}(Me)),new l),ze=new l,Ue=new o,Ve=new h,He=new h,Ge=new h,Xe=new h(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),We=new c,Ye=t("c",u("cc.UITransform")(ve=I(110)(ve=w(((xe=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._priority=0,e._contentSize=me&&me(),e._anchorPoint=ge&&ge(),e}e(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiTransformComp=this},n.onLoad=function(){this.node.parent&&i.insertChangeMap(this.node.parent)},n.onEnable=function(){this.node.on(J.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},n.onDisable=function(){this.node.off(J.PARENT_CHANGED,this._parentChanged,this)},n.onDestroy=function(){this.node._uiProps.uiTransformComp=null},n.setContentSize=function(t,e){var i,n,r=this._contentSize;if(void 0===e){if(R((t=t).width,r.width,b)&&R(t.height,r.height,b))return;i=t.width,n=t.height}else{if(R(t=t,r.width,b)&&R(e,r.height,b))return;i=t,n=e}r.width=i,r.height=n,this.node.emit(J.SIZE_CHANGED),this._markRenderDataDirty()},n.setAnchorPoint=function(t,e){var i=this._anchorPoint;if(void 0===e){if((t=t).x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit(J.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},n.isHit=function(t){for(var e=this._contentSize.width,i=this._contentSize.height,n=Le,r=ze,s=this._getRenderScene().cameras,a=0;a<s.length;a++){var o=s[a];if(o.visibility&this.node.layer){o.node.getWorldRT(Ve);var u=Ve.m12,c=Ve.m13,_=A.center;if(Ve.m12=_.x-(Ve.m00*u+Ve.m04*c),Ve.m13=_.y-(Ve.m01*u+Ve.m05*c),h.invert(Ve,Ve),l.transformMat4(n,t,Ve),this.node.getWorldMatrix(Ge),h.invert(Ve,Ge),!h.strictEquals(Ve,Xe)){l.transformMat4(r,n,Ve),r.x+=this._anchorPoint.x*e,r.y+=this._anchorPoint.y*i;var f=!1;if(r.x>=0&&r.y>=0&&r.x<=e&&r.y<=i&&(f=this._maskTest(n)),f)return!0}}}return!1},n.hitTest=function(t,e){void 0===e&&(e=0);for(var i=this._contentSize.width,n=this._contentSize.height,r=Ue,s=Le,a=ze,u=this._getRenderScene().cameras,c=0;c<u.length;c++){var _=u[c];if(_.visibility&this.node.layer&&(!_.window||_.window.swapchain)&&_.systemWindowId===e&&(o.set(r,t.x,t.y,0),_.screenToWorld(r,r),l.set(s,r.x,r.y),this.node.getWorldMatrix(Ge),h.invert(Ve,Ge),!h.strictEquals(Ve,Xe))){l.transformMat4(a,s,Ve),a.x+=this._anchorPoint.x*i,a.y+=this._anchorPoint.y*n;var f=!1;if(a.x>=0&&a.y>=0&&a.x<=i&&a.y<=n&&(f=this._maskTest(s)),f)return!0}}return!1},n._maskTest=function(t){var e,i,n=null===(e=this.node)||void 0===e||null===(i=e.eventProcessor)||void 0===i?void 0:i.maskList;if(n)for(var r=this.node,s=n.length,a=0,o=0;r&&o<s;++a,r=r.parent){var h=n[o];if(a===h.index){if(r!==h.comp.node){n.length=o;break}var u=h.comp;if(u&&u._enabled&&!u.isHit(t))return!1;o++}else if(a>h.index){n.length=o;break}}return!0},n.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(Ge),h.invert(Ve,Ge),e||(e=new o),o.transformMat4(e,t,Ve)},n.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(Ge),e||(e=new o),o.transformMat4(e,t,Ge)},n.getBoundingBox=function(){var t=new c;return this._selfBoundingBox(t),h.fromSRT(He,this.node.rotation,this.node.position,this.node.scale),t.transformMat4(He),t},n.getBoundingBoxToWorld=function(){for(var t=new c,e=this.node.children,n=0;n<e.length;++n){var r=e[n];if(r&&r.active){var s=r.getComponent(i);s&&s.contentSize.width&&s.contentSize.height&&(s._selfBoundingBox(We),We.transformMat4(r.worldMatrix),0===t.width?t.set(We):c.union(t,t,We))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(We),We.transformMat4(this.node.worldMatrix),0===t.width?t.set(We):c.union(t,t,We)),t},n.getBoundingBoxTo=function(t){var e=new c,n=this.node.children;h.invert(Ve,t);for(var r=0;r<n.length;++r){var s=n[r];if(s&&s.active){var a=s.getComponent(i);a&&a.contentSize.width&&a.contentSize.height&&(a._selfBoundingBox(We),h.multiply(He,s.worldMatrix,Ve),We.transformMat4(He),0===e.width?e.set(We):c.union(e,e,We))}}return this._contentSize.width&&this._contentSize.height&&(this._selfBoundingBox(We),h.multiply(He,this.node.worldMatrix,Ve),We.transformMat4(He),0===e.width?e.set(We):c.union(e,e,We)),e},n.getComputeAABB=function(t){var e=this._contentSize.width,i=this._contentSize.height;We.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),We.transformMat4(this.node.worldMatrix);var n=We.x+.5*We.width,r=We.y+.5*We.height,s=this.node.worldPosition.z,a=We.width/2,o=We.height/2;return null!=t?(C.set(t,n,r,s,a,o,.001),t):new C(n,r,s,a,o,.001)},n._selfBoundingBox=function(t){var e=this._contentSize.width,i=this._contentSize.height;return t.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),t},n._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&i.insertChangeMap(this.node.parent)},n._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&t.markForUpdateRenderData()},i.insertChangeMap=function(t){var e=t.uuid;i.priorityChangeNodeMap.has(e)||i.priorityChangeNodeMap.set(e,t)},i._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var i=t._uiProps.uiTransformComp,n=e._uiProps.uiTransformComp,r=(i?i._priority:0)-(n?n._priority:0);return 0===r?t.getSiblingIndex()-e.getSiblingIndex():r}))},i._sortSiblings=function(){i.priorityChangeNodeMap.forEach((function(t){i._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),i.priorityChangeNodeMap.clear()},i._cleanChangeMap=function(){i.priorityChangeNodeMap.clear()},s(i,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(J.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(J.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(J.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(J.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(J.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(J.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?v(6706):(this._priority=t,this.node.parent&&i.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=nt.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=nt.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),i}($)).EventType=J,xe.priorityChangeNodeMap=new Map,me=T((ye=xe).prototype,"_contentSize",[P],(function(){return new f(100,100)})),ge=T(ye.prototype,"_anchorPoint",[P],(function(){return new l(.5,.5)})),ve=ye))||ve)||ve)||ve);nt.on(st.EVENT_AFTER_UPDATE,Ye._sortSiblings),nt.on(st.EVENT_BEFORE_SCENE_LAUNCH,Ye._cleanChangeMap),F(At),F(Ct),F(Tt),t("I",Oe),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(Oe||t("I",Oe={}));var je,qe=t("b",(Se=u("cc.UIRenderer"),De=M(Ye),Ee=O(ht),we=O(ht),Se(Re=De(((Fe=function(t){function i(){var e;return(e=t.call(this)||this)._renderData=null,e._materials=Ce&&Ce(),e._customMaterial=Te&&Te(),e._srcBlendFactor=Ie&&Ie(),e._dstBlendFactor=be&&be(),e._color=Pe&&Pe(),e._stencilStage=ne.DISABLED,e._assembler=null,e._postAssembler=null,e._renderDataFlag=!0,e._renderFlag=!0,e._renderEntity=void 0,e._instanceMaterialType=-1,e._srcBlendFactorCache=At.SRC_ALPHA,e._dstBlendFactorCache=At.ONE_MINUS_SRC_ALPHA,e._dirtyVersion=-1,e._internalId=-1,e._flagChangedVersion=-1,e._useVertexOpacity=!1,e._lastParent=null,e._renderEntity=e.createRenderEntity(),e}e(i,t);var n=i.prototype;return n.setRenderData=function(t){this._renderData=t},n.onLoad=function(){this._renderEntity.setNode(this.node)},n.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},n.onEnable=function(){this.node.on(J.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(J.SIZE_CHANGED,this._nodeStateChange,this),this.node.on(J.PARENT_CHANGED,this._colorDirty,this),this.updateMaterial(),this._colorDirty(),at.addRenderer(this),this.markForUpdateRenderData()},n.onRestore=function(){this.updateMaterial(),this.markForUpdateRenderData()},n.onDisable=function(){this.node.off(J.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(J.SIZE_CHANGED,this._nodeStateChange,this),this.node.off(J.PARENT_CHANGED,this._colorDirty,this),at.removeRenderer(this),this._renderFlag=!1,this._renderEntity.enabled=!1},n.onDestroy=function(){if(this._renderEntity.setNode(null),this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++){var e=this._materialInstances[t];e&&e.destroy()}},n.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),t){var e=this._renderData;e&&(e.vertDirty=!0),at.markDirtyRenderer(this)}},n.requestRenderData=function(t){void 0===t&&(t=ie.COMP);var e=Ne.add();return e.initRenderDrawInfo(this,t),this._renderData=e,e},n.destroyRenderData=function(){this._renderData&&(this._renderData.removeRenderDrawInfo(this),Ne.remove(this._renderData),this._renderData=null)},n.updateRenderer=function(){this._assembler&&this._assembler.updateRenderData(this),this._renderFlag=this._canRender(),this._renderEntity.enabled=this._renderFlag},n.fillBuffers=function(t){this._renderFlag&&this._render(t)},n.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},n._render=function(){},n._postRender=function(){},n._canRender=function(){return null!==this.getSharedMaterial(0)&&this._enabled&&this._color.a>0},n._postCanRender=function(){},n.updateMaterial=function(){if(this._customMaterial)this.getSharedMaterial(0)!==this._customMaterial&&this.setSharedMaterial(this._customMaterial,0);else{var t=this._updateBuiltinMaterial();this.setSharedMaterial(t,0),this.stencilStage!==ne.ENTER_LEVEL&&this.stencilStage!==ne.ENTER_LEVEL_INVERTED||this.getMaterialInstance(0).recompileShaders({USE_ALPHA_TEST:!0}),this._updateBlendFunc()}},n._updateColor=function(){if(this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0),this.setEntityColor(this._color),this.setEntityOpacity(this.node._uiProps.localOpacity),this._assembler){this._assembler.updateColor(this);var t=this._renderFlag;if(this._renderFlag=this._canRender(),this.setEntityEnabled(this._renderFlag),t!==this._renderFlag){var e=this.renderData;e&&(e.vertDirty=!0)}}},i.setEntityColorDirtyRecursively=function(t,e){var n=t._uiProps.uiComp;n&&n.color&&(n._renderEntity.colorDirty=e);for(var r=0;r<t.children.length;r++)i.setEntityColorDirtyRecursively(t.children[r],e)},n.setEntityColorDirty=function(){},n.setEntityColor=function(){},n.setEntityOpacity=function(){},n.setEntityEnabled=function(){},n._updateBlendFunc=function(){var t=this.getRenderMaterial(0).passes[0].blendState.targets[0];if(this._dstBlendFactorCache=t.blendDst,this._srcBlendFactorCache=t.blendSrc,this._dstBlendFactorCache!==this._dstBlendFactor||this._srcBlendFactorCache!==this._srcBlendFactor){(t=this.getMaterialInstance(0).passes[0].blendState.targets[0]).blend=!0,t.blendDstAlpha=At.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor;var e=this.getMaterialInstance(0).passes[0];e.blendState.setTarget(0,t),e._updatePassHash(),this._dstBlendFactorCache=this._dstBlendFactor,this._srcBlendFactorCache=this._srcBlendFactor}},n._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var e=this.node.children[t].getComponent(i);e&&e.markForUpdateRenderData()}},n._colorDirty=function(){this.node._uiProps.colorDirty=!0,this.setEntityColorDirty(!0)},n._onMaterialModified=function(e,i){this._renderData&&(this.markForUpdateRenderData(),this._renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,e,i)},n._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case Oe.ADD_COLOR:t=ot.get("ui-base-material");break;case Oe.GRAYSCALE:t=ot.get("ui-sprite-gray-material");break;case Oe.USE_ALPHA_SEPARATED:t=ot.get("ui-sprite-alpha-sep-material");break;case Oe.USE_ALPHA_SEPARATED_AND_GRAY:t=ot.get("ui-sprite-gray-alpha-sep-material");break;default:t=ot.get("ui-sprite-material")}return t},n.setNodeDirty=function(){this._renderData&&(this._renderData.nodeDirty=!0)},n.setTextureDirty=function(){this._renderData&&(this._renderData.textureDirty=!0)},n.createRenderEntity=function(){return new Be(ce.STATIC)},s(i,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setSharedMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setSharedMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"useVertexOpacity",get:function(){return this._useVertexOpacity}},{key:"stencilStage",get:function(){return this._stencilStage},set:function(t){this._stencilStage=t,this._renderEntity.setStencilStage(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t}},{key:"batcher",get:function(){return nt.root.batcher2D}},{key:"renderEntity",get:function(){return this._renderEntity}}]),i}(It)).BlendState=At,Fe.Assembler=null,Fe.PostAssembler=null,B((Ae=Fe).prototype,"sharedMaterials",[k],Object.getOwnPropertyDescriptor(Ae.prototype,"sharedMaterials"),Ae.prototype),B(Ae.prototype,"customMaterial",[Ee],Object.getOwnPropertyDescriptor(Ae.prototype,"customMaterial"),Ae.prototype),Ce=T(Ae.prototype,"_materials",[k],(function(){return[]})),Te=T(Ae.prototype,"_customMaterial",[we],(function(){return null})),Ie=T(Ae.prototype,"_srcBlendFactor",[P],(function(){return At.SRC_ALPHA})),be=T(Ae.prototype,"_dstBlendFactor",[P],(function(){return At.ONE_MINUS_SRC_ALPHA})),Pe=T(Ae.prototype,"_color",[P],(function(){return D.WHITE.clone()})),Re=Ae))||Re)||Re));i.internal.UIRenderer=qe,N({RenderComponent:{newName:"UIRenderer",since:"1.2.0",removed:!0},UITransformComponent:{newName:"UITransform",since:"1.2.0",removed:!1},CanvasComponent:{newName:"Canvas",since:"1.2.0",removed:!1}}),N({UIRenderable:{newName:"UIRenderer",since:"3.0.0",removed:!0}}),N({Renderable2D:{newName:"UIRenderer",since:"3.6.0",removed:!1}});var Ke=new f,Qe=((je={})[n.ORIENTATION_AUTO]=L.AUTO,je[n.ORIENTATION_LANDSCAPE]=L.LANDSCAPE,je[n.ORIENTATION_PORTRAIT]=L.PORTRAIT,je),Ze=t("V",function(t){function n(){var e;(e=t.call(this)||this)._designResolutionSize=void 0,e._scaleX=void 0,e._scaleY=void 0,e._viewportRect=void 0,e._visibleRect=void 0,e._autoFullScreen=void 0,e._retinaEnabled=void 0,e._resizeCallback=void 0,e._resolutionPolicy=void 0,e._rpExactFit=void 0,e._rpShowAll=void 0,e._rpNoBorder=void 0,e._rpFixedHeight=void 0,e._rpFixedWidth=void 0;var i=Je,n=$e;return e._designResolutionSize=new f(0,0),e._scaleX=1,e._scaleY=1,e._viewportRect=new c(0,0,0,0),e._visibleRect=new c(0,0,0,0),e._autoFullScreen=!1,e._retinaEnabled=!1,e._resizeCallback=null,e._rpExactFit=new ti(i.EQUAL_TO_FRAME,n.EXACT_FIT),e._rpShowAll=new ti(i.EQUAL_TO_FRAME,n.SHOW_ALL),e._rpNoBorder=new ti(i.EQUAL_TO_FRAME,n.NO_BORDER),e._rpFixedHeight=new ti(i.EQUAL_TO_FRAME,n.FIXED_HEIGHT),e._rpFixedWidth=new ti(i.EQUAL_TO_FRAME,n.FIXED_WIDTH),e._resolutionPolicy=e._rpShowAll,e}e(n,t);var r=n.prototype;return r.init=function(){var t=z.windowSize,e=t.width,i=t.height;this._designResolutionSize.width=e,this._designResolutionSize.height=i,this._viewportRect.width=e,this._viewportRect.height=i,this._visibleRect.width=e,this._visibleRect.height=i,Ke.width=this._visibleRect.width,Ke.height=this._visibleRect.height,A&&A.init(this._visibleRect),this.resizeWithBrowserSize(!0);var n=U.querySettings(V.Category.SCREEN,"designResolution");n&&this.setDesignResolutionSize(Number(n.width),Number(n.height),n.policy||ti.FIXED_HEIGHT),z.on("window-resize",this._updateAdaptResult,this),z.on("fullscreen-change",this._updateAdaptResult,this)},r.resizeWithBrowserSize=function(t){H.handleResizeEvent=t},r.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},r.setOrientation=function(t){H.orientation=Qe[t]},r.adjustViewportMeta=function(){},r.enableRetina=function(t){this._retinaEnabled=!!t},r.isRetinaEnabled=function(){return this._retinaEnabled},r.enableAutoFullScreen=function(t){t!==this._autoFullScreen&&(this._autoFullScreen=t,t&&z.requestFullScreen().catch((function(){})))},r.isAutoFullScreenEnabled=function(){return this._autoFullScreen},r.setCanvasSize=function(t,e){H.resolutionScale=1;var i=H.devicePixelRatio,n=new f(t*i,e*i);z.windowSize=n},r.getCanvasSize=function(){return z.windowSize},r.getFrameSize=function(){var t=H.devicePixelRatio,e=z.windowSize;return e.width/=t,e.height/=t,e},r.setFrameSize=function(t,e){var i=H.devicePixelRatio;z.windowSize=new f(t*i,e*i)},r.getVisibleSize=function(){return new f(this._visibleRect.width,this._visibleRect.height)},r.getVisibleSizeInPixel=function(){return new f(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},r.getVisibleOrigin=function(){return new l(this._visibleRect.x,this._visibleRect.y)},r.getVisibleOriginInPixel=function(){return new l(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},r.getResolutionPolicy=function(){return this._resolutionPolicy},r._updateResolutionPolicy=function(t){if(t instanceof ti)this._resolutionPolicy=t;else{var e=ti;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},r.setResolutionPolicy=function(t){this._updateResolutionPolicy(t);var e=ii.getDesignResolutionSize();ii.setDesignResolutionSize(e.width,e.height,t)},r.setDesignResolutionSize=function(t,e,i){if(t>0&&e>0){this._updateResolutionPolicy(i);var n=this._resolutionPolicy;n&&n.preApply(this),this._designResolutionSize.width=t,this._designResolutionSize.height=e;var r=n.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var s=this._viewportRect,a=this._visibleRect,o=r.viewport;s.x=o.x,s.y=o.y,s.width=o.width,s.height=o.height,a.x=0,a.y=0,a.width=o.width/this._scaleX,a.height=o.height/this._scaleY}n.postApply(this),Ke.width=this._visibleRect.width,Ke.height=this._visibleRect.height,A&&A.init(this._visibleRect),this.emit("design-resolution-changed")}else d(2200)},r.getDesignResolutionSize=function(){return new f(this._designResolutionSize.width,this._designResolutionSize.height)},r.setRealPixelResolution=function(t,e,i){this.setDesignResolutionSize(t,e,i)},r.getViewportRect=function(){return this._viewportRect},r.getScaleX=function(){return this._scaleX},r.getScaleY=function(){return this._scaleY},r.getDevicePixelRatio=function(){return H.devicePixelRatio},r.convertToLocationInView=function(t,e,i,n){void 0===n&&(n=new l);var r=H.devicePixelRatio*(t-i.left),s=H.devicePixelRatio*(i.top+i.height-e);return H.isFrameRotated?(n.x=z.windowSize.width-s,n.y=r):(n.x=r,n.y=s),n},r._convertToUISpace=function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},r._updateAdaptResult=function(t,e,n){var r;i.director.root.resize(t,e,void 0===n||0===n?1:n);var s=this._designResolutionSize.width,a=this._designResolutionSize.height;t>0&&e>0?this.setDesignResolutionSize(s,a,this._resolutionPolicy):G(!1,"_updateAdaptResult Invalid size."),this.emit("canvas-resize"),null===(r=this._resizeCallback)||void 0===r||r.call(this)},n}(X(a)));Ze.instance=void 0;var Je=function(){function t(){this.name="ContainerStrategy"}var e=t.prototype;return e.preApply=function(){},e.apply=function(){},e.postApply=function(){},e._setupCanvas=function(){var t=i.game.canvas;if(t){var e=z.windowSize;t.width!==e.width&&(t.width=e.width),t.height!==e.height&&(t.height=e.height)}},t}();Je.EQUAL_TO_FRAME=void 0,Je.PROPORTION_TO_FRAME=void 0;var $e=function(){function t(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var e=t.prototype;return e.preApply=function(){},e.apply=function(){return{scale:[1,1]}},e.postApply=function(){},e._buildResult=function(t,e,i,n,r,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);var a=new c(Math.round((t-i)/2),Math.round((e-n)/2),i,n);return this._result.scale=[r,s],this._result.viewport=a,this._result},t}();$e.EXACT_FIT=void 0,$e.SHOW_ALL=void 0,$e.NO_BORDER=void 0,$e.FIXED_HEIGHT=void 0,$e.FIXED_WIDTH=void 0,function(){var t=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="EqualToFrame",e}return e(i,t),i.prototype.apply=function(){H.isProportionalToFrame=!1,this._setupCanvas()},i}(Je),i=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="ProportionalToFrame",e}return e(i,t),i.prototype.apply=function(){H.isProportionalToFrame=!0,this._setupCanvas()},i}(Je);Je.EQUAL_TO_FRAME=new t,Je.PROPORTION_TO_FRAME=new i;var n=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="ExactFit",e}return e(i,t),i.prototype.apply=function(t,e){var i=z.windowSize,n=i.width,r=i.height,s=n/e.width,a=r/e.height;return this._buildResult(n,r,n,r,s,a)},i}($e),r=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="ShowAll",e}return e(i,t),i.prototype.apply=function(t,e){var i,n,r=z.windowSize,s=r.width,a=r.height,o=e.width,h=e.height,u=s/o,c=a/h,_=0;return u<c?(i=s,n=h*(_=u)):(i=o*(_=c),n=a),this._buildResult(s,a,i,n,_,_)},i}($e),s=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="NoBorder",e}return e(i,t),i.prototype.apply=function(t,e){var i,n,r,s=z.windowSize,a=s.width,o=s.height,h=e.width,u=e.height,c=a/h,_=o/u;return c<_?(n=h*(i=_),r=o):(n=a,r=u*(i=c)),this._buildResult(a,o,n,r,i,i)},i}($e),a=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="FixedHeight",e}return e(i,t),i.prototype.apply=function(t,e){var i=z.windowSize,n=i.width,r=i.height,s=r/e.height,a=n,o=r;return this._buildResult(n,r,a,o,s,s)},i}($e),o=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).name="FixedWidth",e}return e(i,t),i.prototype.apply=function(t,e){var i=z.windowSize,n=i.width,r=i.height,s=n/e.width,a=n,o=r;return this._buildResult(n,r,a,o,s,s)},i}($e);$e.EXACT_FIT=new n,$e.SHOW_ALL=new r,$e.NO_BORDER=new s,$e.FIXED_HEIGHT=new a,$e.FIXED_WIDTH=new o}();var ti=t("r",function(){function t(t,e){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)}var e=t.prototype;return e.preApply=function(t){this._contentStrategy.preApply(t)},e.apply=function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},e.postApply=function(t){this._contentStrategy.postApply(t)},e.setContainerStrategy=function(t){t instanceof Je&&(this._containerStrategy=t)},e.setContentStrategy=function(t){t instanceof $e&&(this._contentStrategy=t)},s(t,[{key:"canvasSize",get:function(){return z.windowSize}}]),t}());ti.EXACT_FIT=0,ti.NO_BORDER=1,ti.SHOW_ALL=2,ti.FIXED_HEIGHT=3,ti.FIXED_WIDTH=4,ti.UNKNOWN=5,ti.ContainerStrategy=Je,ti.ContentStrategy=$e,i.ResolutionPolicy=ti;var ei,ii=t("h",Ze.instance=i.view=new Ze);nt.registerSystem("view",ii,0),i.winSize=Ke;var ni,ri,si,ai,oi,hi,ui,ci,_i,li=t("R",u("cc.RenderRoot2D")(ei=I(100)(ei=M(Ye)(ei=w(ei=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var r=n.prototype;return r.onEnable=function(){i.director.root.batcher2D.addScreen(this)},r.onDisable=function(){i.director.root.batcher2D.removeScreen(this)},r.onDestroy=function(){i.director.root.batcher2D.removeScreen(this)},n}($))||ei)||ei)||ei)||ei),fi=new o,di=W({OVERLAY:0,INTERSPERSE:1}),pi=t("C",(ni=u("cc.Canvas"),ri=I(100),si=O(bt),ai=O(bt),ni(oi=ri(oi=w((hi=function(t){function i(){var e;return(e=t.call(this)||this)._cameraComponent=ui&&ui(),e._alignCanvasWithScreen=ci&&ci(),e._thisOnCameraResized=void 0,e.fitDesignResolution_EDITOR=void 0,e._pos=new o,e._renderMode=di.OVERLAY,e._thisOnCameraResized=e._onResizeCamera.bind(Y(e)),e}e(i,t);var n=i.prototype;return n.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on(bt.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)),this._onResizeCamera(),this.node.on(J.TRANSFORM_CHANGED,this._thisOnCameraResized)},n.onEnable=function(){t.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on(bt.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDisable=function(){t.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off(bt.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.node.off(J.TRANSFORM_CHANGED,this._thisOnCameraResized)},n._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=A.height/2;else{var t=z.windowSize;this._cameraComponent.orthoHeight=t.height/ii.getScaleY()/2}this.node.getWorldPosition(fi),this._cameraComponent.node.setWorldPosition(fi.x,fi.y,1e3)}},n._getViewPriority=function(){if(this._cameraComponent){var t,e=null===(t=this.cameraComponent)||void 0===t?void 0:t.priority;return this._renderMode===di.OVERLAY?e|1<<30:e&~(1<<30)}return 0},s(i,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),i}(li),B(hi.prototype,"cameraComponent",[si],Object.getOwnPropertyDescriptor(hi.prototype,"cameraComponent"),hi.prototype),ui=T(hi.prototype,"_cameraComponent",[ai],(function(){return null})),ci=T(hi.prototype,"_alignCanvasWithScreen",[P],(function(){return!0})),oi=hi))||oi)||oi)||oi));i.Canvas=pi;var vi,yi,mi,gi,xi,Si,Di,Ei,wi,Ri,Ai,Ci,Ti=t("U",u("cc.UIComponent")(_i=M(Ye)(_i=I(110)(_i=w(_i=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._lastParent=null,e.stencilStage=ne.DISABLED,e}e(i,t);var n=i.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){},n.onDisable=function(){},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},n.postUpdateAssembler=function(){},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},i}($))||_i)||_i)||_i)||_i);j(Ti.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),q(pi.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){var t;return null===(t=this._cameraComponent)||void 0===t?void 0:t.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:D.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),K(Ye.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),i.UITransformComponent=Ye,Q(Ye,"cc.UITransformComponent"),Q(qe,"cc.RenderComponent"),i.CanvasComponent=pi,Q(pi,"cc.CanvasComponent"),i.internal.Renderable2D=qe,Q(qe,"cc.Renderable2D"),function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED"}(Ci||(Ci={})),t("d",(vi=u("cc.SpriteRenderer"),yi=I(100),mi=O(Gt),vi(gi=yi((xi=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._spriteFrame=Si&&Si(),e._mode=Di&&Di(),e._color=Ei&&Ei(),e._flipX=wi&&wi(),e._flipY=Ri&&Ri(),e._size=Ai&&Ai(),e._model=null,e}e(n,t);var r=n.prototype;return r.onLoad=function(){this._spriteFrame&&(this._spriteFrame.mesh||this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels()},r.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene()},r.onEnable=function(){t.prototype.onEnable.call(this),this._model||this._updateModels(),this._attachToScene()},r.onDisable=function(){this._model&&this._detachFromScene()},r.onDestroy=function(){this._model&&(i.director.root.destroyModel(this._model),this._model=null,this._models.length=0)},r._updateModels=function(){if(this._spriteFrame){var t=this._model;if(t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model){var e=this._spriteFrame.mesh;this._model.createBoundingShape(e.struct.minPosition,e.struct.maxPosition),this._updateModelParams(),this._onUpdateLocalDescriptorSet()}}},r._createModel=function(){var t=this._model=i.director.root.createModel(ut);t.visFlags=this.visibility,t.node=t.transform=this.node,this._models.length=0,this._models.push(this._model)},r._updateModelParams=function(){if(this._spriteFrame&&this._model){this._spriteFrame.ensureMeshData();var t=this._spriteFrame.mesh;this.node.hasChangedFlags|=ct.POSITION,this._model.transform.hasChangedFlags|=ct.POSITION;var e=t?t.renderingSubMeshes:null;if(e)for(var i=e.length,n=0;n<i;++n){var r=this.getRenderMaterial(n);r&&!r.isValid&&(r=null);var s=e[n];s&&this._model.initSubModel(n,s,r||this._getBuiltinMaterial())}this._model.enabled=!0}},r._getBuiltinMaterial=function(){return ot.get("missing-material")},r._onMaterialModified=function(e,i){t.prototype._onMaterialModified.call(this,e,i),this._spriteFrame&&this._model&&this._model.inited&&this._onRebuildPSO(e,i||this._getBuiltinMaterial())},r._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.setSubModelMaterial(t,e),this._onUpdateLocalDescriptorSet())},r._onUpdateLocalDescriptorSet=function(){if(this._spriteFrame&&this._model&&this._model.inited)for(var t=this._spriteFrame.getGFXTexture(),e=this._spriteFrame.getGFXSampler(),i=this._model.subModels,n=_t.SAMPLER_SPRITE,r=0;r<i.length;r++){var s=i[r].descriptorSet;s.bindTexture(n,t),s.bindSampler(n,e),s.update()}},r._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},r._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},s(n,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame,this._spriteFrame=t,this._spriteFrame&&(this._spriteFrame.ensureMeshData(),this._spriteFrame.mesh.initialize()),this._updateModels(),this.enabledInHierarchy&&this._attachToScene())}},{key:"model",get:function(){return this._model}}]),n}(Ft),B(xi.prototype,"spriteFrame",[mi],Object.getOwnPropertyDescriptor(xi.prototype,"spriteFrame"),xi.prototype),Si=T(xi.prototype,"_spriteFrame",[P],(function(){return null})),Di=T(xi.prototype,"_mode",[P],(function(){return Ci.SIMPLE})),Ei=T(xi.prototype,"_color",[P],(function(){return D.WHITE.clone()})),wi=T(xi.prototype,"_flipX",[P],(function(){return!1})),Ri=T(xi.prototype,"_flipY",[P],(function(){return!1})),Ai=T(xi.prototype,"_size",[P],(function(){return new l})),gi=xi))||gi)||gi))}}}));
