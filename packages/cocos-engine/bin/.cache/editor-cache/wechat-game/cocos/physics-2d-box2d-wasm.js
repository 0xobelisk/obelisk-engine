System.register(["./index-fd5c57ca.js","./index-92d00b49.js","./wasm-minigame-c1b4b430.js","./deprecated-8cbcc834.js","./director-44a98d9f.js","./sprite-renderer-c04ed900.js","./sprite-5f8bb119.js","./deprecated-1e41692e.js","./pipeline-state-manager-45d8faaf.js","./node-event-c62a1caf.js","./collision-matrix-a4853247.js","./buffer-barrier-a7de2d9a.js","./touch-df137fff.js","./renderer-2125723a.js","./camera-component-324b3634.js","./create-mesh-b322554e.js","./mesh-4be1d55f.js","./deprecated-a7c6f62a.js","./model-renderer-05cff7aa.js","./deprecated-c8756aed.js"],(function(t,i){"use strict";var e,n,o,r,s,a,c,l,u,h,d,f,y,_,p,g,m,b,x,v,w,S,P,A,C,B,D,T,j,M,F,G,L,V,k,R,I;return{setters:[function(t){e=t.d,n=t.f,o=t.C,r=t.g,s=t.E,a=t.i,c=t.R,l=t.n,u=t.s},function(t){h=t.a,d=t.e,f=t.V,y=t.B,_=t.o,p=t.av,g=t.O,m=t.Q,b=t.cB,x=t.bC,v=t.T,w=t.H,S=t.N,P=t.y,A=t.bF,C=t.w},function(t){B=t.e,D=t.i},function(t){T=t.g,j=t.G},function(t){M=t.az,F=t.aU,G=t.ax},function(t){L=t.C},function(){},function(t){V=t.G},function(t){k=t.b},function(t){R=t.N},function(t){I=t.P},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var t={};function E(t){return t?t.$$.ptr:0}var W=new Map;function q(t,i,e){if(e){var n=W.get(t);n||(n=new Map,W.set(t,n)),n.set(e,i)}}function O(t,i){if(i){var e=W.get(t);e&&e.has(i)&&(e.delete(i),0===e.size&&W.delete(t))}}function N(t,i){var e=W.get(t);return null==e?void 0:e.get(i)}var J,z=new Map;function H(t,i,e){if(e){var n=z.get(t);n||(n=new Map,z.set(t,n)),n.set(e,i)}}function U(t,i){if(i){var e=z.get(t);e&&e.has(i)&&(e.delete(i),0===e.size&&z.delete(t))}}function Q(t,i,e){e.x=t.q.c*i.x-t.q.s*i.y+t.p.x,e.y=t.q.s*i.x+t.q.c*i.y+t.p.y}T.onPostInfrastructureInitDelegate.add((function(){return B().then((function(){return Promise.all([i.import("./box2d.release.wasm-54708a62.js"),i.import("./box2d.release.wasm-3f952f37.js")]).then((function(i){return e=i[0].default,n=i[1].default,new Promise((function(i,o){var r=function(t){return"[box2d]: box2d wasm lib load failed: "+t};e({instantiateWasm:function(t,i){D(n,t).then((function(t){i(t.instance,t.module)})).catch((function(t){return o(r(t))}))}}).then((function(i){h("[box2d]:box2d wasm lib loaded."),t=i})).then(i).catch((function(t){return o(r(t))}))}));var e,n}))})).catch((function(t){d(t)}))}));var Y,X=function(){function t(){}return t.BeginContact=function(t){this._BeginContact&&this._BeginContact(t)},t.EndContact=function(t){this._EndContact&&this._EndContact(t)},t.PreSolve=function(t,i){this._PreSolve&&this._PreSolve(t,i)},t.PostSolve=function(t,i){this._PostSolve&&this._PostSolve(t,i)},t}();J=X,X._BeginContact=null,X._EndContact=null,X._PreSolve=null,X._PostSolve=null,X.callback={BeginContact:function(t){J.BeginContact(t)},EndContact:function(t){J.EndContact(t)},PreSolve:function(t,i){J.PreSolve(t,i)},PostSolve:function(t,i){J.PostSolve(t,i)}};var Z,K=function(){function i(){}return i.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},i.ReportFixture=function(i){return this._isPoint?t.FixtureTestPoint(i,this._point)&&this._fixtures.push(i):this._fixtures.push(i),!0},i.getFixture=function(){return this._fixtures[0]},i.getFixtures=function(){return this._fixtures},i}();Y=K,K._point={x:0,y:0},K._isPoint=!1,K._fixtures=[],K.callback={ReportFixture:function(t){return Y.ReportFixture(t)}};var $=function(){function i(){}return i.init=function(t,e){i._type=t,i._mask=e,i._fixtures.length=0,i._points.length=0,i._normals.length=0,i._fractions.length=0},i.ReportFixture=function(n,o,r,s){return 0==(t.FixtureGetFilterData(n).categoryBits&i._mask)?0:i._type===e.Closest?(i._fixtures[0]=n,i._points[0]=o,i._normals[0]=r,i._fractions[0]=s,s):(i._fixtures.push(n),i._points.push(new f(o.x,o.y)),i._normals.push(new f(r.x,r.y)),i._fractions.push(s),i._type===e.Any?0:i._type>=e.All?1:s)},i.getFixtures=function(){return i._fixtures},i.getPoints=function(){return i._points},i.getNormals=function(){return i._normals},i.getFractions=function(){return i._fractions},i}();Z=$,$._type=e.Closest,$._fixtures=[],$._points=[],$._normals=[],$._fractions=[],$._mask=4294967295,$.callback={ReportFixture:function(t,i,e,n){return Z.ReportFixture(t,i,e,n)}};var tt,it=[],et=[new f,new f],nt={points:[],separations:[],normal:new f},ot=function(){this.localPoint=new f,this.normalImpulse=0,this.tangentImpulse=0},rt=[new ot,new ot],st={type:0,localPoint:new f,localNormal:new f,points:[]},at={normalImpulses:[],tangentImpulses:[]},ct=function(){function i(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this.disabledOnce=!1,this._impulsePtr=0,this._inverted=!1,this._implPtr=0,this._b2WorldmanifoldPtr=0}i.get=function(t){var e=it.pop();return e||(e=new i),e.init(t),e},i.put=function(t){var i=N(2,t);i&&(it.push(i),i.reset())};var e=i.prototype;return e._setImpulse=function(t){this._impulsePtr=t},e.init=function(i){var e=t.ContactGetFixture(i);this.colliderA=N(0,e.x).collider,this.colliderB=N(0,e.y).collider,this.disabled=!1,this.disabledOnce=!1,this._impulsePtr=0,this._inverted=!1,this._implPtr=i,q(2,this,this._implPtr),this._b2WorldmanifoldPtr=t.WorldManifoldNew()},e.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulsePtr=0,O(2,this._implPtr),this._implPtr=0,t.WorldManifoldDelete(this._b2WorldmanifoldPtr),this._b2WorldmanifoldPtr=0},e.getWorldManifold=function(){var i=nt.points,e=nt.separations,o=nt.normal;t.ContactGetWorldManifold(this._implPtr,this._b2WorldmanifoldPtr);var r=t.ContactGetManifold(this._implPtr),s=t.ManifoldGetPointCount(r);i.length=e.length=s;for(var a=0;a<s;a++){var c=et[a];c.x=t.WorldManifoldGetPointValueX(this._b2WorldmanifoldPtr,a)*n,c.y=t.WorldManifoldGetPointValueY(this._b2WorldmanifoldPtr,a)*n,i[a]=c,e[a]=t.WorldManifoldGetSeparationValue(this._b2WorldmanifoldPtr,a)*n}return o.x=t.WorldManifoldGetNormalValueX(this._b2WorldmanifoldPtr),o.y=t.WorldManifoldGetNormalValueY(this._b2WorldmanifoldPtr),this._inverted&&(o.x*=-1,o.y*=-1),nt},e.getManifold=function(){for(var i=st.points,e=st.localNormal,o=st.localPoint,r=t.ContactGetManifold(this._implPtr),s=i.length=t.ManifoldGetPointCount(r),a=0;a<s;a++){var c=rt[a],l=t.ManifoldGetManifoldPointPtr(r,a);c.localPoint.x=t.ManifoldPointGetLocalPointX(l)*n,c.localPoint.y=t.ManifoldPointGetLocalPointY(l)*n,c.normalImpulse=t.ManifoldPointGetNormalImpulse(l)*n,c.tangentImpulse=t.ManifoldPointGetTangentImpulse(l),i[a]=c}return o.x=t.ManifoldGetLocalPointValueX(r)*n,o.y=t.ManifoldGetLocalPointValueY(r)*n,e.x=t.ManifoldGetLocalNormalValueX(r),e.y=t.ManifoldGetLocalNormalValueY(r),st.type=t.ManifoldGetType(r),this._inverted&&(e.x*=-1,e.y*=-1),st},e.getImpulse=function(){var i=this._impulsePtr;if(!i)return null;for(var e=at.normalImpulses,o=at.tangentImpulses,r=t.ContactImpulseGetCount(i),s=0;s<r;s++)e[s]=t.ContactImpulseGetNormalImpulse(i,s)*n,o[s]=t.ContactImpulseGetTangentImpulse(i,s);return o.length=e.length=r,at},e.emit=function(t){switch(t){case o.BEGIN_CONTACT:case o.END_CONTACT:case o.PRE_SOLVE:case o.POST_SOLVE:}var i=this.colliderA,e=this.colliderB,n=i.body,s=e.body;n.enabledContactListener&&(null==i||i.emit(t,i,e,this)),s.enabledContactListener&&(null==e||e.emit(t,e,i,this)),(n.enabledContactListener||s.enabledContactListener)&&r.instance.emit(t,i,e,this),(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},e.setEnabled=function(i){t.ContactSetEnabled(this._implPtr,i)},e.isTouching=function(){return t.ContactIsTouching(this._implPtr)},e.setTangentSpeed=function(i){t.ContactSetTangentSpeed(this._implPtr,i)},e.getTangentSpeed=function(){return t.ContactGetTangentSpeed(this._implPtr)},e.setFriction=function(i){t.ContactSetFriction(this._implPtr,i)},e.getFriction=function(){return t.ContactGetFriction(this._implPtr)},e.resetFriction=function(){t.ContactResetFriction(this._implPtr)},e.setRestitution=function(i){t.ContactSetRestitution(this._implPtr,i)},e.getRestitution=function(){return t.ContactGetRestitution(this._implPtr)},e.resetRestitution=function(){t.ContactResetRestitution(this._implPtr)},i}(),lt={x:0,y:0},ut={x:0,y:0},ht=new y,dt=y.GREEN,ft=y.RED,yt=function(){function i(){}i._DrawPolygon=function(e,o){for(var r=i._drawer,s=t.HEAPF32.subarray(e/4,e/4+2*o),a=0;a<o;a++){lt.x=s[2*a+0],lt.y=s[2*a+1],Q(i._xf,lt,ut);var c=ut.x*n,l=ut.y*n;0===a?r.moveTo(c,l):r.lineTo(c,l)}r.close()},i.DrawPolygon=function(t,e,n){i._applyStrokeColor(n),i._DrawPolygon(t,e),i._drawer.stroke()},i.DrawSolidPolygon=function(t,e,n){i._applyFillColor(n),i._DrawPolygon(t,e),i._drawer.fill(),i._drawer.stroke()},i._DrawCircle=function(t,e){Q(i._xf,t,ut),i._drawer.circle(ut.x*n,ut.y*n,e*n)},i.DrawCircle=function(t,e,n){i._applyStrokeColor(n),i._DrawCircle(t,e),i._drawer.stroke()},i.DrawSolidCircle=function(t,e,n,o){i._applyFillColor(o),i._DrawCircle(t,e),i._drawer.fill()},i.DrawSegment=function(t,e,o){var r=i._drawer;if(t.x===e.x&&t.y===e.y)return i._applyFillColor(o),i._DrawCircle(t,2/n),void r.fill();i._applyStrokeColor(o),Q(i._xf,t,lt),r.moveTo(lt.x*n,lt.y*n),Q(i._xf,e,lt),r.lineTo(lt.x*n,lt.y*n),r.stroke()},i.DrawTransform=function(t){var e=i._drawer;e.strokeColor=ft,lt.x=lt.y=0,Q(t,lt,ut),e.moveTo(ut.x*n,ut.y*n),lt.x=1,lt.y=0,Q(t,lt,ut),e.lineTo(ut.x*n,ut.y*n),e.stroke(),e.strokeColor=dt,lt.x=lt.y=0,Q(t,lt,ut),e.moveTo(ut.x*n,ut.y*n),lt.x=0,lt.y=1,Q(t,lt,ut),e.lineTo(ut.x*n,ut.y*n),e.stroke()},i.DrawPoint=function(){},i.DrawParticles=function(){},i._applyStrokeColor=function(t){i._drawer.strokeColor=ht.set(255*t.r,255*t.g,255*t.b,150)},i._applyFillColor=function(t){i._drawer.fillColor=ht.set(255*t.r,255*t.g,255*t.b,150)};var e=i.prototype;return e.PushTransform=function(t){i._xf=t},e.PopTransform=function(){i._xf=i._dxf},i}();tt=yt,yt.callback={DrawPolygon:function(t,i,e){tt.DrawPolygon(t,i,e)},DrawSolidPolygon:function(t,i,e){tt.DrawSolidPolygon(t,i,e)},DrawCircle:function(t,i,e){tt.DrawCircle(t,i,e)},DrawSolidCircle:function(t,i,e,n){tt.DrawSolidCircle(t,i,e,n)},DrawSegment:function(t,i,e){tt.DrawSegment(t,i,e)},DrawTransform:function(t){tt.DrawTransform(t)},DrawPoint:function(t,i,e){tt.DrawPoint(t,i,e)}},yt._drawer=null,yt._xf={p:{x:0,y:0},q:{s:0,c:1}},yt._dxf={p:{x:0,y:0},q:{s:0,c:1}};var _t=new _,pt=new f,gt=new f,mt=[],bt=function(){function i(){this._world=void 0,this._bodies=[],this._animatedBodies=[],this._rotationAxis=new _,this._physicsGroundBody=void 0,this._contactListener=void 0,this._aabbQueryCallback=void 0,this._raycastQueryCallback=void 0,this._temoBodyDef=void 0,this._tempB2AABB=void 0,this.tempB2FixtureDefPtr=void 0,this._debugGraphics=null,this._b2DebugDrawer=null,this._debugDrawFlags=0,this._world=new t.World({x:0,y:-10}),this._physicsGroundBody=this._world.CreateBody(new t.BodyDef),X._BeginContact=this._onBeginContact,X._EndContact=this._onEndContact,X._PreSolve=this._onPreSolve,X._PostSolve=this._onPostSolve,this._contactListener=t.ContactListener.implement(X.callback),this._world.SetContactListener(this._contactListener),this._aabbQueryCallback=t.QueryCallback.implement(K.callback),this._raycastQueryCallback=t.RayCastCallback.implement($.callback),this._temoBodyDef=new t.BodyDef,this._tempB2AABB=new t.AABB,this.tempB2FixtureDefPtr=t.FixtureDefNew()}var r=i.prototype;return r._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var i=M("Canvas");if(!i){var e=F.getScene();if(!e)return;(i=new G("Canvas")).addComponent(L),i.parent=e}var n=new G("PHYSICS_2D_DEBUG_DRAW");n.hideFlags|=p.Flags.DontSave,n.parent=i,n.worldPosition=_.ZERO,n.layer=k.Enum.UI_2D,this._debugGraphics=n.addComponent(V),this._debugGraphics.lineWidth=3,yt._drawer=this._debugGraphics;var o=t.Draw.implement(yt.callback);this._b2DebugDrawer=o,this._world.SetDebugDraw(o)}var r=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(r.children.length-1),this._b2DebugDrawer&&this._b2DebugDrawer.SetFlags(this.debugDrawFlags)},r.setGravity=function(t){this._world.SetGravity(t)},r.setAllowSleep=function(){this._world.SetAllowSleeping(!0)},r.step=function(t,i,e){void 0===i&&(i=10),void 0===e&&(e=10);for(var n=this._animatedBodies,o=0,r=n.length;o<r;o++)n[o].animate(t);this._world.Step(t,i,e)},r.raycast=function(t,i,o,r){if(t.equals(i))return[];o=o||e.Closest,pt.x=t.x/n,pt.y=t.y/n,gt.x=i.x/n,gt.y=i.y/n,$.init(o,r),this._world.RayCast(this._raycastQueryCallback,pt,gt);var s=$.getFixtures();if(s.length>0){for(var a=$.getPoints(),c=$.getNormals(),l=$.getFractions(),u=[],h=0,d=s.length;h<d;h++){var y=s[h],_=N(0,y),p=_.collider;if(o===e.AllClosest){for(var g=void 0,m=0;m<u.length;m++)u[m].collider===p&&(g=u[m]);if(g){l[h]<g.fraction&&(g.fixtureIndex=_.getFixtureIndex(y),g.point.x=a[h].x*n,g.point.y=a[h].y*n,g.normal.x=c[h].x,g.normal.y=c[h].y,g.fraction=l[h]);continue}}u.push({collider:p,fixtureIndex:_.getFixtureIndex(y),point:new f(a[h].x*n,a[h].y*n),normal:new f(c[h].x,c[h].y),fraction:l[h]})}return u}return[]},r.syncPhysicsToScene=function(){for(var t=this._bodies,i=0,e=t.length;i<e;i++){var o=t[i],r=o.rigidBody;if(r.type!==s.Animated){var a=r.node,c=o.impl,l=c.GetPosition();_t.x=l.x*n,_t.y=l.y*n,_t.z=0,a.worldPosition=_t;var u=g(c.GetAngle());a.setWorldRotationFromEuler(0,0,u)}else o.resetVelocity()}},r.syncSceneToPhysics=function(){for(var t=this._bodies,i=0;i<t.length;i++)t[i].syncSceneToPhysics()},r.addBody=function(i){if(!this._bodies.includes(i)){var e=this._temoBodyDef,o=i.rigidBody;e.allowSleep=o.allowSleep,e.gravityScale=o.gravityScale,e.linearDamping=o.linearDamping,e.angularDamping=o.angularDamping,e.fixedRotation=o.fixedRotation,e.bullet=o.bullet;var r=o.node,a=r.worldPosition;if(e.position={x:a.x/n,y:a.y/n},_t.z=m.getAxisAngle(this._rotationAxis,r.worldRotation),this._rotationAxis.z<0&&(_t.z=2*Math.PI-_t.z),e.angle=_t.z,e.awake=o.awakeOnLoad,o.type===s.Animated)e.type=t.BodyType.b2_kinematicBody,this._animatedBodies.push(i),i._animatedPos.set(e.position.x,e.position.y),i._animatedAngle=e.angle;else switch(o.type){case s.Dynamic:e.type=t.BodyType.b2_dynamicBody;break;case s.Static:e.type=t.BodyType.b2_staticBody;break;case s.Kinematic:e.type=t.BodyType.b2_kinematicBody;break;default:e.type=t.BodyType.b2_staticBody}var c=o,l=c._linearVelocity;e.linearVelocity={x:l.x,y:l.y},e.angularVelocity=c._angularVelocity;var u=this._world.CreateBody(e);q(1,i,E(u)),H(1,u,E(u)),i._imp=u,this._bodies.push(i)}},r.removeBody=function(t){this._bodies.includes(t)&&(t.impl&&(O(1,E(t.impl)),U(1,E(t.impl)),this._world.DestroyBody(t.impl),t._imp=null),b(this._bodies,t),t.rigidBody.type===s.Animated&&b(this._animatedBodies,t))},r.registerContactFixture=function(t){this._contactListener.registerContactFixture(t)},r.unregisterContactFixture=function(t){this._contactListener.unregisterContactFixture(t)},r.testPoint=function(t){var i=pt.x=t.x/n,e=pt.y=t.y/n,o=.2/n;this._tempB2AABB.lowerBound={x:i-o,y:e-o},this._tempB2AABB.upperBound={x:i+o,y:e+o};var r=this._aabbQueryCallback;K.init(pt),this._world.QueryAABB(r,this._tempB2AABB);var s=K.getFixtures();mt.length=0;for(var a=0;a<s.length;a++){var c=N(0,s[a]).collider;mt.includes(c)||mt.push(c)}return mt},r.testAABB=function(t){this._tempB2AABB.lowerBound={x:t.xMin/n,y:t.yMin/n},this._tempB2AABB.upperBound={x:t.xMax/n,y:t.yMax/n};var i=this._aabbQueryCallback;K.init(),this._world.QueryAABB(i,this._tempB2AABB);var e=K.getFixtures();mt.length=0;for(var o=0;o<e.length;o++){var r=N(0,e[o]).collider;mt.includes(r)||mt.push(r)}return mt},r.drawDebug=function(){this._checkDebugDrawValid(),this._debugGraphics&&(this._debugGraphics.clear(),this._world.DebugDraw())},r._onBeginContact=function(t){ct.get(t).emit(o.BEGIN_CONTACT)},r._onEndContact=function(t){var i=N(2,t);i&&(i.emit(o.END_CONTACT),ct.put(t))},r._onPreSolve=function(t){var i=N(2,t);i&&i.emit(o.PRE_SOLVE)},r._onPostSolve=function(t,i){var e=N(2,t);e&&(e._setImpulse(i),e.emit(o.POST_SOLVE),e._setImpulse(0))},x(i,[{key:"impl",get:function(){return this._world}},{key:"groundBodyImpl",get:function(){return this._physicsGroundBody}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){t||this._debugGraphics&&(this._debugGraphics.node.parent=null),this._debugDrawFlags=t}}]),i}(),xt=new _,vt={x:0,y:0},wt={x:0,y:0},St=function(){function i(){this._animatedPos=new f,this._animatedAngle=0,this._body=null,this._rigidBody=void 0,this._inited=!1}var e=i.prototype;return e.initialize=function(t){this._rigidBody=t,r.instance._callAfterStep(this,this._init)},e.onDestroy=function(){r.instance._callAfterStep(this,this._destroy)},e.onEnable=function(){this.setActive(!0)},e.onDisable=function(){this.setActive(!1)},e.nodeTransformChanged=function(t){if(!r.instance.stepping){if(t&G.TransformBit.SCALE)for(var i=this.rigidBody.getComponents(a),e=0;e<i.length;e++)i[e].apply();t&G.TransformBit.POSITION&&this.syncPositionToPhysics(!0),t&G.TransformBit.ROTATION&&this.syncRotationToPhysics(!0)}},e._init=function(){this._inited||(r.instance.physicsWorld.addBody(this),this.setActive(!1),this._inited=!0)},e._destroy=function(){var i,e;if(this._inited){var n=null===(i=this.impl)||void 0===i?void 0:i.GetFixtureList();if(n)for(var o=N(0,n);o&&o.impl;){o.destroy(),o=N(0,t.FixtureGetNext(n))}var s=null===(e=this.impl)||void 0===e?void 0:e.GetJointList();if(s)for(var a=t.JointEdgeGetJoint(s),c=N(0,a);c;)c.destroy(),c=N(0,a=t.JointEdgeGetNext(s));r.instance.physicsWorld.removeBody(this),this._inited=!1}},e.animate=function(t){var i=this._body;if(i){var e=i.GetPosition();i.SetAwake(!0);var n=1/t;vt.x=(this._animatedPos.x-e.x)*n,vt.y=(this._animatedPos.y-e.y)*n,i.SetLinearVelocity(vt);var o=i.GetAngle()%v;o>Math.PI&&(o-=v);var r=(this._animatedAngle-o)*n;this._animatedAngle<-w&&o>w&&(r=(this._animatedAngle+v-o)*n),this._animatedAngle>w&&o<-w&&(r=(this._animatedAngle-v-o)*n),i.SetAngularVelocity(r)}},e.syncSceneToPhysics=function(){var t=this._rigidBody.node.hasChangedFlags;t&&this.nodeTransformChanged(t)},e.syncPositionToPhysics=function(t){void 0===t&&(t=!1);var i=this._body;if(i){var e=this._rigidBody.node.worldPosition;wt.x=e.x/n,wt.y=e.y/n,this._rigidBody.type===s.Animated&&t?this._animatedPos.set(wt.x,wt.y):i.SetTransform(wt,i.GetAngle())}},e.syncRotationToPhysics=function(t){void 0===t&&(t=!1);var i=this._body;if(i){var e=this._rigidBody.node.worldRotation,n=xt;m.toEulerInYXZOrder(n,e);var o=S(n.z);this._rigidBody.type===s.Animated&&t?this._animatedAngle=o:i.SetTransform(i.GetPosition(),o)}},e.resetVelocity=function(){var t=this._body;t&&(vt.x=0,vt.y=0,t.SetLinearVelocity(vt),t.SetAngularVelocity(0))},e.setType=function(i){i===s.Dynamic?this._body.SetType(t.BodyType.b2_dynamicBody):i===s.Kinematic?this._body.SetType(t.BodyType.b2_kinematicBody):i===s.Static&&this._body.SetType(t.BodyType.b2_staticBody)},e.setLinearDamping=function(t){this._body.SetLinearDamping(t)},e.setAngularDamping=function(t){this._body.SetAngularDamping(t)},e.setGravityScale=function(t){this._body.SetGravityScale(t)},e.setFixedRotation=function(t){this._body.SetFixedRotation(t)},e.setAllowSleep=function(t){this._body.SetSleepingAllowed(t)},e.isActive=function(){return this._body.IsEnabled()},e.setActive=function(t){this._body.SetEnabled(t)},e.wakeUp=function(){this._body.SetAwake(!0)},e.sleep=function(){this._body.SetAwake(!1)},e.getMass=function(){return this._body.GetMass()},e.setLinearVelocity=function(t){this._body.SetLinearVelocity(t)},e.getLinearVelocity=function(t){var i=this._body.GetLinearVelocity();return t.x=i.x,t.y=i.y,t},e.getLinearVelocityFromWorldPoint=function(t,i){i=i||new f,vt.x=t.x/n,vt.y=t.y/n;var e=this._body.GetLinearVelocityFromWorldPoint(vt);return i.x=e.x*n,i.y=e.y*n,i},e.setAngularVelocity=function(t){this._body.SetAngularVelocity(t)},e.getAngularVelocity=function(){return this._body.GetAngularVelocity()},e.getLocalVector=function(t,i){i=i||new f,vt.x=t.x/n,vt.y=t.y/n;var e=this._body.GetLocalVector(vt);return i.x=e.x*n,i.y=e.y*n,i},e.getWorldVector=function(t,i){vt.x=t.x/n,vt.y=t.y/n;var e=this._body.GetWorldVector(vt);return i.x=e.x*n,i.y=e.y*n,i},e.getLocalPoint=function(t,i){i=i||new f,vt.x=t.x/n,vt.y=t.y/n;var e=this._body.GetLocalPoint(vt);return i.x=e.x*n,i.y=e.y*n,i},e.getWorldPoint=function(t,i){i=i||new f,vt.x=t.x/n,vt.y=t.y/n;var e=this._body.GetWorldPoint(vt);return i.x=e.x*n,i.y=e.y*n,i},e.getLocalCenter=function(t){t=t||new f;var i=this._body.GetLocalCenter();return t.x=i.x*n,t.y=i.y*n,t},e.getWorldCenter=function(t){t=t||new f;var i=this._body.GetWorldCenter();return t.x=i.x*n,t.y=i.y*n,t},e.getInertia=function(){return this._body.GetInertia()},e.applyForce=function(t,i,e){this._body&&(vt.x=i.x/n,vt.y=i.y/n,this._body.ApplyForce(t,vt,e))},e.applyForceToCenter=function(t,i){this._body&&this._body.ApplyForceToCenter(t,i)},e.applyTorque=function(t,i){this._body&&this._body.ApplyTorque(t,i)},e.applyLinearImpulse=function(t,i,e){this._body&&(vt.x=i.x/n,vt.y=i.y/n,this._body.ApplyLinearImpulse(t,vt,e))},e.applyLinearImpulseToCenter=function(t,i){this._body&&this._body.ApplyLinearImpulse(t,this._body.GetPosition(),i)},e.applyAngularImpulse=function(t,i){this._body&&this._body.ApplyAngularImpulse(t,i)},x(i,[{key:"impl",get:function(){return this._body}},{key:"_imp",set:function(t){this._body=t}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"isAwake",get:function(){return this._body.IsAwake()}},{key:"isSleeping",get:function(){return!this._body.IsAwake()}}]),i}(),Pt={categoryBits:0,maskBits:0,groupIndex:0},At={x:0,y:0},Ct={x:0,y:0};function Bt(t){var i=t.collider;return i.body?Pt.categoryBits=i.group===I.DEFAULT?i.body.group:i.group:Pt.categoryBits=i.group,Pt.maskBits=r.instance.collisionMatrix[Pt.categoryBits],Pt}var Dt=function(){function i(){this._shapes=[],this._fixtures=[],this._collider=null,this._body=null,this._inited=!1,this._rect=new P}var e=i.prototype;return e.initialize=function(t){this._collider=t},e.onLoad=function(){},e.onEnable=function(){r.instance._callAfterStep(this,this._init)},e.onDisable=function(){r.instance._callAfterStep(this,this.destroy)},e.start=function(){},e.onGroupChanged=function(){var i=Bt(this);this._fixtures.forEach((function(e){t.FixtureSetFilterData(e,i)}))},e.apply=function(){this.destroy(),this.collider.enabledInHierarchy&&this._init()},e.getFixtureIndex=function(t){return this._fixtures.indexOf(t)},e._createShapes=function(){return[]},e._init=function(){if(!this._inited){var i=this.collider,e=i.node.worldScale,n=_.ZERO,o=i.getComponent(c);o&&o.impl&&o.impl.impl?this._body=o.impl.impl:(this._body=r.instance.physicsWorld.groundBodyImpl,n=i.node.worldPosition);for(var s=0===e.x&&0===e.y?[]:this._createShapes(e.x,e.y,n.x,n.y),a=Bt(this),l=0;l<s.length;l++){var u=s[l],h=r.instance.physicsWorld.tempB2FixtureDefPtr;t.FixtureDefSetAll(h,u,0,i.friction,i.restitution,i.density,i.sensor,a.categoryBits,a.maskBits,a.groupIndex);var d=t.BodyCreateFixture(E(this._body),h);q(0,this,d),H(0,d,d),null!=o&&o.enabledContactListener&&r.instance.physicsWorld.registerContactFixture(d),this._shapes.push(u),this._fixtures.push(d)}this._inited=!0}},e.destroy=function(){if(this._inited){for(var i=this._fixtures,e=this._body,n=i.length-1;n>=0;n--){var o=i[n];O(0,o),U(0,o),r.instance.physicsWorld.unregisterContactFixture(o),e&&t.BodyDestroyFixture(E(e),o)}this._body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},x(i,[{key:"impl",get:function(){return this._shapes}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){for(var i=1e7,e=i,o=i,r=-i,s=-i,a=this._fixtures,c=0;c<a.length;c++)for(var l=a[c],u=t.FixtureGetShape(l),h=t.ShapeGetChildCount(u),d=0;d<h;d++){var f=t.FixtureGetAABB(l,d);if(At.x=f.lowerBound.x,At.y=f.lowerBound.y,Ct.x=f.upperBound.x,Ct.y=f.upperBound.y,2===t.ShapeGetType(u)){var y=t.ShapeGetRadius(u);At.x+=y,At.y+=y,Ct.x+=y,Ct.y+=y}At.x<e&&(e=At.x),At.y<o&&(o=At.y),Ct.x>r&&(r=Ct.x),Ct.y>s&&(s=Ct.y)}e*=n,o*=n,r*=n,s*=n;var _=this._rect;return _.x=e,_.y=o,_.width=r-e,_.height=s-o,_}}]),i}(),Tt=new P,jt=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._worldPoints=[new f,new f,new f,new f],t}return A(e,i),e.prototype._createShapes=function(i,e,o,r){i=Math.abs(i),e=Math.abs(e);var s=this.collider,a=s.size.width/2/n*i,c=s.size.height/2/n*e,l=(o+s.offset.x*i)/n,u=(r+s.offset.y*e)/n,h=t.PolygonShapeNew();return t.PolygonShapeSetAsBoxWithCenterAndAngle(h,a,c,l,u,0),[h]},x(e,[{key:"worldPoints",get:function(){var t=Tt,i=this.collider,e=i.size,n=i.offset;t.x=n.x-e.width/2,t.y=n.y-e.height/2,t.width=e.width,t.height=e.height;var o=this._worldPoints,r=o[0],s=o[1],a=o[2],c=o[3];return t.transformMat4ToPoints(i.node.worldMatrix,r,s,a,c),o}}]),e}(Dt),Mt=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._worldPosition=new f,t}return A(e,i),e.prototype._createShapes=function(i,e,o,r){i=Math.abs(i),e=Math.abs(e);var s=this.collider,a=(o+s.offset.x*i)/n,c=(r+s.offset.y*e)/n,l=t.CircleShapeNew();return t.ShapeSetRadius(l,s.radius/n*i),t.CircleShapeSetPosition(l,a,c),[l]},x(e,[{key:"worldRadius",get:function(){return t.CircleShapeGetRadius(this._shapes[0])*n}},{key:"worldPosition",get:function(){var i=t.CircleShapeGetPosition(this._shapes[0]);return this._worldPosition.set(i.x*n,i.y*n)}}]),e}(Dt),Ft=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._worldPoints=[],t}return A(e,i),e.prototype._createShapes=function(i,e,o,r){var s=[],a=this.collider,c=a.points;c.length>0&&c[0].equals(c[c.length-1])&&(c.length-=1);var u=l(c);if(!u)return C("[Physics2D] b2PolygonShape failed to decompose polygon into convex polygons, node name: ",a.node.name),s;for(var h=a.offset,d=0;d<u.length;d++){for(var f=u[d],y=0,_=t.Vec2VectorNew(),p=null,g=0,m=f.length;g<m;g++){y||(y=t.PolygonShapeNew());var b=f[g],x=(o+(b.x+h.x)*i)/n,v=(r+(b.y+h.y)*e)/n,w={x:x,y:v};if(t.Vec2VectorPush(_,x,v),p||(p=w),t.Vec2VectorSize(_)===t.maxPolygonVertices&&(t.PolygonShapeSet(y,t.Vec2VectorGetPtr(_),t.Vec2VectorSize(_)),s.push(y),y=0,g<m-1)){var S=t.Vec2VectorGet(_,t.Vec2VectorSize(_)-1);t.Vec2VectorResize(_,0,0,0),t.Vec2VectorPush(_,p.x,p.y),t.Vec2VectorPush(_,S.x,S.y)}}y&&(t.PolygonShapeSet(y,t.Vec2VectorGetPtr(_),t.Vec2VectorSize(_)),s.push(y)),t.Vec2VectorDelete(_)}return s},x(e,[{key:"worldPoints",get:function(){for(var t=this.collider,i=t.points,e=this._worldPoints,n=t.node.worldMatrix,o=0;o<i.length;o++)e[o]||(e[o]=new f),f.transformMat4(e[o],i[o],n);return e.length=i.length,this._worldPoints}}]),e}(Dt),Gt=function(){function t(){this._b2joint=null,this._jointComp=null,this._body=null,this._inited=!1}var i=t.prototype;return i.initialize=function(t){this._jointComp=t},i.onEnable=function(){r.instance._callAfterStep(this,this._init)},i.onDisable=function(){r.instance._callAfterStep(this,this.destroy)},i.start=function(){r.instance._callAfterStep(this,this._init)},i.apply=function(){r.instance._callAfterStep(this,this.destroy),this.comp.enabledInHierarchy&&r.instance._callAfterStep(this,this._init)},i._init=function(){if(!this._inited){var t=this._jointComp;if(t.isValid)if(this._body=t.getComponent(c),this._body){var i=this._createJointDef();if(i){i.SetBodyA(this._body.impl.impl);var e=t.connectedBody;e&&!e.enabledInHierarchy||(e?i.SetBodyB(e.impl.impl):i.SetBodyB(r.instance.physicsWorld.groundBodyImpl),i.collideConnected=t.collideConnected,this._b2joint=r.instance.physicsWorld.impl.CreateJoint(i),q(3,this,E(this._b2joint)),H(3,this._b2joint,E(this._b2joint)),this._inited=!0)}}else C("Joint2D: Body is not found, can not create joint. Node Name: "+t.node.name)}},i.destroy=function(){this._inited&&(O(3,E(this._b2joint)),U(3,E(this._b2joint)),r.instance.physicsWorld.impl.DestroyJoint(this._b2joint),this._b2joint=null,this._inited=!1)},i._createJointDef=function(){return null},i.isValid=function(){return this._b2joint&&this._body&&this._body.impl&&this._jointComp},x(t,[{key:"impl",get:function(){return this._b2joint}},{key:"comp",get:function(){return this._jointComp}},{key:"body",get:function(){return this._body}}]),t}(),Lt={x:0,y:0},Vt=function(i){function e(){for(var t,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(t=i.call.apply(i,[this].concat(n))||this)._touchPoint=new f,t._isTouched=!1,t}A(e,i);var o=e.prototype;return o.setTarget=function(t){this._b2joint&&(Lt.x=t.x/n,Lt.y=t.y/n,this._b2joint.SetTarget(Lt))},o.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},o.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},o._createJointDef=function(){var i=new t.MouseJointDef,e=this._jointComp;return i.target={x:this._touchPoint.x/n,y:this._touchPoint.y/n},i.maxForce=e.maxForce,i.dampingRatio=e.dampingRatio,i.frequencyHz=e.frequency,i},o.initialize=function(t){i.prototype.initialize.call(this,t);var e=M("Canvas");e&&(e.on(R.TOUCH_START,this.onTouchBegan,this),e.on(R.TOUCH_MOVE,this.onTouchMove,this),e.on(R.TOUCH_END,this.onTouchEnd,this),e.on(R.TOUCH_CANCEL,this.onTouchEnd,this))},o.onEnable=function(){},o.start=function(){},o.onTouchBegan=function(t){this._isTouched=!0;var i=this._touchPoint.set(t.getUILocation()),e=r.instance.physicsWorld.testPoint(i);if(!(e.length<=0)){var n=e[0].body;n.wakeUp();var o=this._jointComp;o.connectedBody=n,this._init(),this.setMaxForce(o.maxForce*n.getMass()),this.setTarget(i)}},o.onTouchMove=function(t){this._touchPoint=t.getUILocation()},o.onTouchEnd=function(){this.destroy(),this._isTouched=!1},o.update=function(){this._isTouched&&this.isValid()&&this.setTarget(this._touchPoint)},e}(Gt),kt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setMaxLength=function(t){this._b2joint&&this._b2joint.SetMaxLength(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.RopeJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.maxLength=i.maxLength/n,e},e}(Gt),Rt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},o.setDistance=function(t){this._b2joint&&this._b2joint.SetLength(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.DistanceJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.length=i.distance/n,e.dampingRatio=i.dampingRatio,e.frequencyHz=i.frequency,e},e}(Gt),It={x:0,y:0},Et=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},o.setAngularOffset=function(t){this._b2joint&&this._b2joint.SetAngularOffset(S(t))},o.setLinearOffset=function(t){this._b2joint&&(It.x=t.x/n,It.y=t.y/n,this._b2joint.SetLinearOffset(It))},o.setCorrectionFactor=function(t){this._b2joint&&this._b2joint.SetCorrectionFactor(t)},o.setMaxTorque=function(t){this._b2joint&&this._b2joint.SetMaxTorque(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.MotorJointDef;return e.linearOffset={x:i.linearOffset.x/n,y:i.linearOffset.y/n},e.angularOffset=S(i.angularOffset),e.maxForce=i.maxForce,e.maxTorque=i.maxTorque,e.correctionFactor=i.correctionFactor,e},e}(Gt),Wt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},o.setLowerLimit=function(){this.updateLimits()},o.setUpperLimit=function(){this.updateLimits()},o.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(t.lowerLimit/n,t.upperLimit/n)}},o.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},o.setMaxMotorForce=function(t){this._b2joint&&this._b2joint.SetMaxMotorForce(t)},o.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.PrismaticJointDef;e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n};var o=S(i.angle);return e.localAxisA={x:Math.cos(o),y:Math.sin(o)},e.referenceAngle=0,e.enableLimit=i.enableLimit,e.lowerTranslation=i.lowerLimit/n,e.upperTranslation=i.upperLimit/n,e.enableMotor=i.enableMotor,e.maxMotorForce=i.maxMotorForce,e.motorSpeed=i.motorSpeed,e},e}(Gt),qt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.WeldJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.referenceAngle=0,e.dampingRatio=i.dampingRatio,e.frequencyHz=i.frequency,e},e}(Gt),Ot=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.setFrequency=function(t){this._b2joint&&this._b2joint.SetSpringFrequencyHz(t)},o.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetSpringDampingRatio(t)},o.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},o.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},o.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.WheelJointDef;e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n};var o=S(i.angle);return e.localAxisA={x:Math.cos(o),y:Math.sin(o)},e.maxMotorTorque=i.maxMotorTorque,e.motorSpeed=S(i.motorSpeed),e.enableMotor=i.enableMotor,e.dampingRatio=i.dampingRatio,e.frequencyHz=i.frequency,e},e}(Gt),Nt=function(i){function e(){return i.apply(this,arguments)||this}A(e,i);var o=e.prototype;return o.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},o.setLowerAngle=function(){this.updateLimits()},o.setUpperAngle=function(){this.updateLimits()},o.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(S(t.lowerAngle),S(t.upperAngle))}},o.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},o.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},o.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},o._createJointDef=function(){var i=this._jointComp,e=new t.RevoluteJointDef;return e.localAnchorA={x:i.anchor.x/n,y:i.anchor.y/n},e.localAnchorB={x:i.connectedAnchor.x/n,y:i.connectedAnchor.y/n},e.enableMotor=i.enableMotor,e.maxMotorTorque=i.maxMotorTorque,e.motorSpeed=S(i.motorSpeed),e.enableLimit=i.enableLimit,e.lowerAngle=S(i.lowerAngle),e.upperAngle=S(i.upperAngle),e},e}(Gt);T.once(j.EVENT_PRE_SUBSYSTEM_INIT,(function(){u.register("box2d-wasm",{PhysicsWorld:bt,RigidBody:St,BoxShape:jt,CircleShape:Mt,PolygonShape:Ft,MouseJoint:Vt,DistanceJoint:kt,SpringJoint:Rt,RelativeJoint:Et,SliderJoint:Wt,FixedJoint:qt,WheelJoint:Ot,HingeJoint:Nt})}))}}}));
